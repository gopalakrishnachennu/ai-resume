(function(){var E=Object.defineProperty;var I=(i,t,e)=>t in i?E(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var d=(i,t,e)=>I(i,typeof t!="symbol"?t+"":t,e);const b={boolToYesNo:(i,t)=>{if(!i||i.length===0)return t?"Yes":"No";const e=i.find(r=>/^(yes|yep|correct|true)$/i.test(r.trim())),n=i.find(r=>/yes|agree/i.test(r)),a=e||n||i[0],o=i.find(r=>/^(no|nope|incorrect|false)$/i.test(r.trim())),s=i.find(r=>/no|disagree/i.test(r)),l=o||s||i[1]||i[0];return t?a:l},authToOption:(i,t)=>{if(!i||i.length===0)return"Yes";const e=t.toLowerCase(),a={citizen:/citizen|authorized|without.*sponsor|permanent.*resident/i,greencard:/green.*card|permanent.*resident|authorized/i,visa:/visa|require.*sponsor|sponsorship/i,other:/other|not.*authorized/i}[e]||/authorized/i;return i.find(o=>a.test(o))??i[0]},formatSalary:(i,t)=>{var e;if(!i||i.length===0)return t.toString();for(const n of i)if((e=n.match(/\d+/g))==null||e.map(a=>parseInt(a)),n.includes((t/1e3).toString()))return n;return i.find(n=>n.includes(t.toString()))??i[0]},formatPhone:(i,t)=>t,toString:(i,t)=>String(t)},w={"first name":{path:"identity.firstName"},"given name":{path:"identity.firstName"},first:{path:"identity.firstName"},"last name":{path:"identity.lastName"},"family name":{path:"identity.lastName"},surname:{path:"identity.lastName"},last:{path:"identity.lastName"},"full name":{path:"identity.fullName"},name:{path:"identity.fullName"},email:{path:"identity.email"},"email address":{path:"identity.email"},phone:{path:"identity.phone",transform:"formatPhone"},"phone number":{path:"identity.phone",transform:"formatPhone"},mobile:{path:"identity.phone",transform:"formatPhone"},"contact number":{path:"identity.phone",transform:"formatPhone"},address:{path:"identity.location.address"},"street address":{path:"identity.location.address"},city:{path:"identity.location.city"},town:{path:"identity.location.city"},state:{path:"identity.location.state"},province:{path:"identity.location.state"},region:{path:"identity.location.state"},zip:{path:"identity.location.zip"},"zip code":{path:"identity.location.zip"},"postal code":{path:"identity.location.zip"},country:{path:"identity.location.country"},linkedin:{path:"identity.linkedin"},"linkedin url":{path:"identity.linkedin"},"linkedin profile":{path:"identity.linkedin"},github:{path:"identity.github"},"github url":{path:"identity.github"},portfolio:{path:"identity.portfolio"},website:{path:"identity.website"},"personal website":{path:"identity.website"},"are you legally authorized to work in the united states?":{path:"authorization.workAuth",transform:"authToOption"},"are you legally authorized to work in the country where this job is located?":{path:"authorization.workAuth",transform:"authToOption"},"work authorization":{path:"authorization.workAuth",transform:"authToOption"},"will you now or in the future require sponsorship for employment visa status?":{path:"authorization.needSponsor",transform:"boolToYesNo"},"do you require sponsorship?":{path:"authorization.needSponsor",transform:"boolToYesNo"},sponsorship:{path:"authorization.needSponsor",transform:"boolToYesNo"},"are you willing to relocate?":{path:"authorization.willingToRelocate",transform:"boolToYesNo"},"willing to relocate":{path:"authorization.willingToRelocate",transform:"boolToYesNo"},relocation:{path:"authorization.willingToRelocate",transform:"boolToYesNo"},"desired salary":{path:"role.salaryMin",transform:"formatSalary"},"expected salary":{path:"role.salaryMin",transform:"formatSalary"},"salary expectation":{path:"role.salaryMin",transform:"formatSalary"},"preferred start date":{path:"role.startDate"},"start date":{path:"role.startDate"},"notice period":{path:"role.noticePeriod"},"how did you hear about us?":{path:"meta.source",transform:"sourceToOption"},gender:{path:"compliance.gender"},"what is your gender?":{path:"compliance.gender"},race:{path:"compliance.ethnicity"},"race/ethnicity":{path:"compliance.ethnicity"},ethnicity:{path:"compliance.ethnicity"},"veteran status":{path:"compliance.veteran"},"are you a veteran?":{path:"compliance.veteran"},"disability status":{path:"compliance.disability"},"are you disabled?":{path:"compliance.disability"},school:{path:"education.history.0.school"},university:{path:"education.history.0.school"},degree:{path:"education.history.0.degree"},major:{path:"education.history.0.fieldOfStudy"},"field of study":{path:"education.history.0.fieldOfStudy"},"current company":{path:"experience.currentCompany"},"current employer":{path:"experience.currentCompany"},"current title":{path:"experience.currentTitle"},"job title":{path:"experience.currentTitle"}},j=[{regex:/first\s*name|given\s*name/i,path:"identity.firstName"},{regex:/last\s*name|family\s*name|surname/i,path:"identity.lastName"},{regex:/full\s*name/i,path:"identity.fullName"},{regex:/phone|mobile|cell/i,path:"identity.phone",transform:"formatPhone"},{regex:/email/i,path:"identity.email"},{regex:/address|street/i,path:"identity.location.address"},{regex:/city|town/i,path:"identity.location.city"},{regex:/zip|postal/i,path:"identity.location.zip"},{regex:/linkedin/i,path:"identity.linkedin"},{regex:/github/i,path:"identity.github"},{regex:/portfolio|website/i,path:"identity.portfolio"},{regex:/salary|compensation|pay|wage/i,path:"role.salaryMin",transform:"formatSalary"},{regex:/start\s*date/i,path:"role.startDate"},{regex:/notice/i,path:"role.noticePeriod"},{regex:/authorized.*work|legal.*work|eligible.*work/i,path:"authorization.workAuth",transform:"authToOption"},{regex:/sponsor/i,path:"authorization.needSponsor",transform:"boolToYesNo"},{regex:/relocat/i,path:"authorization.willingToRelocate",transform:"boolToYesNo"},{regex:/gender|sex/i,path:"compliance.gender"},{regex:/race|ethnicity/i,path:"compliance.ethnicity"},{regex:/veteran/i,path:"compliance.veteran"},{regex:/disability/i,path:"compliance.disability"}],A=[{patterns:[/why.*work.*here/i,/why.*interested/i,/why.*apply/i,/what.*attract.*company/i,/why.*join.*us/i],generate:(i,t)=>{const e=(t==null?void 0:t.jobTitle)||i.role.targetTitle||"this role",n=(t==null?void 0:t.company)||"your organization";return`I am excited about the opportunity to bring my expertise in ${i.skills.technical.slice(0,3).join(", ")} to ${n}. The ${e} position aligns perfectly with my career goals, and I am drawn to the company's mission and values. I believe my ${i.experience.totalYears||"several"} years of experience would allow me to make meaningful contributions to your team.`}},{patterns:[/tell.*about.*yourself/i,/describe.*yourself/i,/professional.*summary/i,/about.*you/i,/introduce.*yourself/i],generate:i=>{const t=i.experience.totalYears||"several",e=i.role.targetTitle||i.experience.currentTitle||"professional",n=i.skills.technical.slice(0,4).join(", ");return`I am a ${e} with ${t} years of experience. My core competencies include ${n}. I am passionate about delivering high-quality work and continuously learning new technologies.`}},{patterns:[/what.*strength/i,/your.*strength/i,/greatest.*strength/i,/top.*skill/i],generate:i=>{const t=i.skills.technical.slice(0,3),e=i.skills.soft.slice(0,2);return`My key strengths include ${[...t,...e].join(", ")}. I excel at problem-solving and collaborating with cross-functional teams to deliver results.`}},{patterns:[/what.*weakness/i,/your.*weakness/i,/area.*improvement/i,/what.*improve/i],generate:()=>"I sometimes focus too much on details, which I've learned to balance by setting clear priorities. I've been working on delegating more effectively and trusting my team members with responsibilities."},{patterns:[/where.*5.*year/i,/where.*five.*year/i,/career.*goal/i,/long.*term.*goal/i,/future.*plan/i],generate:i=>`In five years, I see myself in a ${i.role.targetTitle||"leadership role"} where I can drive strategic initiatives and mentor junior team members. I am committed to continuous learning and growing with an organization that values innovation and professional development.`},{patterns:[/why.*leaving/i,/why.*leave.*current/i,/reason.*change/i,/why.*looking/i],generate:()=>"I am seeking new challenges and opportunities for growth that align with my career goals. While I've learned a great deal in my current role, I am excited about the possibility of contributing to a new team and expanding my skill set."},{patterns:[/salary.*expect/i,/compensation.*expect/i,/desired.*salary/i,/what.*salary/i],generate:i=>{const t=i.role.salaryMin,e=i.role.salaryMax;return t&&e?`My salary expectation is in the range of $${t.toLocaleString()} to $${e.toLocaleString()}, depending on the total compensation package and benefits.`:"I am open to discussing compensation based on the responsibilities of the role and the overall benefits package."}},{patterns:[/cover.*letter/i,/additional.*information/i,/anything.*else/i,/what.*else.*know/i],generate:(i,t)=>{const e=(t==null?void 0:t.company)||"your organization",n=i.skills.technical.slice(0,3).join(", ");return`I am enthusiastic about the opportunity to join ${e}. With my background in ${n} and proven track record of delivering results, I am confident I would be a strong addition to your team. I look forward to discussing how I can contribute to your success.`}},{patterns:[/how.*hear.*about/i,/where.*find.*job/i,/source.*application/i,/how.*discover/i],generate:()=>"LinkedIn"}];function C(i){const t=i.toLowerCase().trim();for(const e of A)if(e.patterns.some(n=>n.test(t)))return e;return null}function F(i,t,e){return i.generate(t,e)}function x(i,t){if(i===t)return 0;if(i.length===0)return t.length;if(t.length===0)return i.length;const e=i.length,n=t.length;if(e>n)return x(t,i);const a=new Int32Array(e+1);for(let o=0;o<=e;o++)a[o]=o;for(let o=1;o<=n;o++){let s=o;for(let l=1;l<=e;l++){let r;t[o-1]===i[l-1]?r=a[l-1]:r=Math.min(a[l-1]+1,Math.min(s+1,a[l]+1)),a[l-1]=s,s=r}a[e]=s}return a[e]}const h="jobfiller_ai_cache";async function T(i){const t=k(i);try{const a=((await chrome.storage.local.get(h))[h]||{})[t];if(a)return console.log(`[Cache Hit] "${i}" -> "${a.answer}"`),a.answer}catch(e){console.warn("Cache read failed",e)}return null}async function O(i,t){const e=k(i),n={question:i,answer:t,timestamp:Date.now()};try{const o=(await chrome.storage.local.get(h))[h]||{},s=Object.keys(o);if(s.length>500){const l=s.reduce((r,c)=>o[r].timestamp<o[c].timestamp?r:c);delete o[l]}o[e]=n,await chrome.storage.local.set({[h]:o})}catch(a){console.warn("Cache write failed",a)}}function k(i){return i.toLowerCase().replace(/[^a-z0-9]/g,"")}const N="llama3-8b-8192";async function R(i,t){var l,r,c,p;const{settings:e}=await chrome.storage.local.get("settings"),n=e==null?void 0:e.groqApiKey;if(!n)throw new Error("Groq API Key missing");const a=JSON.stringify(t.profile,null,2),o=(l=t.options)!=null&&l.length?`Choose strictly from these options: ${JSON.stringify(t.options)}`:"Answer concisely.",s=`You are a helpful assistant filling out a job application for this user. 
User Profile: ${a}

Rules:
1. Be truthful based on profile.
2. If info is missing, say "N/A".
3. Output ONLY the answer value, no explanation.
4. ${o}`;try{const u=await fetch("https://api.groq.com/openai/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({model:(e==null?void 0:e.groqModel)||N,messages:[{role:"system",content:s},{role:"user",content:`Question: ${i}`}],temperature:.1,max_tokens:100})});if(!u.ok)throw new Error(`Groq API Error: ${u.statusText}`);return((p=(c=(r=(await u.json()).choices[0])==null?void 0:r.message)==null?void 0:c.content)==null?void 0:p.trim())||""}catch(u){throw console.error("Groq AI failed:",u),u}}async function $(i,t){var l,r;if(!((l=window.ai)!=null&&l.languageModel))throw new Error("Gemini Nano not supported");if((await window.ai.languageModel.capabilities()).available==="no")throw new Error("Gemini Nano not available");const n=await window.ai.languageModel.create(),a={name:t.profile.identity.fullName,email:t.profile.identity.email,skills:t.profile.skills.technical.slice(0,10),job:t.profile.role.targetTitle,company:t.profile.experience.currentCompany},o=(r=t.options)!=null&&r.length?`Options: ${JSON.stringify(t.options)}`:"",s=`
Context: ${JSON.stringify(a)}
Question: ${i}
${o}
Answer with only the value.
`;try{return(await n.prompt(s)).trim()}catch(c){throw console.error("Nano failed",c),c}}const P=[/ssn|social\s*security/i,/bank|routing/i,/password/i],q=[/background\s*check/i,/drug\s*test/i,/consent/i];class z{constructor(t,e){d(this,"jobContext");this.profile=t,this.jobContext=e}async resolve(t){const e=t.label.toLowerCase().trim();if(P.some(o=>o.test(e)))return{tier:0,value:null,confidence:1,strategy:"security-block",action:"skip",reason:"sensitive-data"};if(q.some(o=>o.test(e)))return{tier:0,value:null,confidence:1,strategy:"user-consent",action:"ask",reason:"requires-consent"};if(t.element.value,w[e]){const o=w[e],s=this.getValueByPath(o.path);if(s)return{tier:2,value:s,confidence:1,strategy:"canonical-exact",transform:o.transform}}for(const[o,s]of Object.entries(w)){if(Math.abs(e.length-o.length)>3)continue;if(x(e,o)<=2){const r=this.getValueByPath(s.path);if(r)return{tier:3,value:r,confidence:.9,strategy:`fuzzy-canonical(${o})`,transform:s.transform}}}for(const o of j)if(o.regex.test(e)){const s=this.getValueByPath(o.path);if(s)return{tier:4,value:s,confidence:.85,strategy:"regex-pattern",transform:o.transform}}const n=C(t.label);if(n)return{tier:5,value:F(n,this.profile,this.jobContext),confidence:.8,strategy:"template-match"};const a=await T(e);if(a)return{tier:6,value:a,confidence:.8,strategy:"ai-cache"};try{const o=await R(t.label,{profile:this.profile,options:t.options});if(o)return await O(e,o),{tier:7,value:o,confidence:.7,strategy:"groq-ai"}}catch(o){console.warn("Groq failed, trying fallback",o)}try{const o=await $(t.label,{profile:this.profile,options:t.options});if(o)return{tier:8,value:o,confidence:.6,strategy:"gemini-nano"}}catch{}return{tier:9,value:null,confidence:0,strategy:"failed",action:"manual"}}getValueByPath(t){return t.split(".").reduce((e,n)=>e?e[n]:null,this.profile)}}class m{matches(t){return this.hostPatterns.some(e=>e.test(t))}async waitUntilReady(){await new Promise(t=>setTimeout(t,500))}async verify(t,e){const n=t.element;return n.value===e||n.value.includes(e)}getLabel(t){var s,l,r;const e=t.getAttribute("aria-label");if(e)return e.trim();const n=t.id;if(n){const c=document.querySelector(`label[for="${n}"]`);if(c)return((s=c.textContent)==null?void 0:s.trim())||""}const a=t.closest("label");if(a)return((l=a.textContent)==null?void 0:l.trim())||"";const o=t.previousElementSibling;return o&&o.tagName==="LABEL"?((r=o.textContent)==null?void 0:r.trim())||"":t.getAttribute("placeholder")||t.getAttribute("name")||""}getOptions(t){if(t.tagName==="SELECT")return Array.from(t.options).map(n=>n.text);const e=t.getAttribute("name");if(e){const n=document.querySelectorAll(`input[name="${e}"]`);return Array.from(n).map(a=>{var s;const o=document.querySelector(`label[for="${a.id}"]`);return((s=o==null?void 0:o.textContent)==null?void 0:s.trim())||a.value})}return[]}async typeValue(t,e){t.focus(),t.value=e,t.dispatchEvent(new Event("input",{bubbles:!0})),t.dispatchEvent(new Event("change",{bubbles:!0})),t.blur()}async selectOption(t,e){const a=Array.from(t.options).find(o=>o.text.toLowerCase().includes(e.toLowerCase())||o.value.toLowerCase().includes(e.toLowerCase()));return a?(t.value=a.value,t.dispatchEvent(new Event("change",{bubbles:!0})),!0):!1}async clickOption(t,e){var a;const n=document.querySelectorAll(`input[name="${t}"]`);for(const o of n){const s=document.querySelector(`label[for="${o.id}"]`);if((((a=s==null?void 0:s.textContent)==null?void 0:a.trim())||o.value).toLowerCase().includes(e.toLowerCase()))return o.click(),!0}return!1}}class M extends m{constructor(){super(...arguments);d(this,"name","lever");d(this,"hostPatterns",[/jobs\.lever\.co/i,/lever\.co\/.*\/apply/i])}async getFields(){const e=[],n=document.querySelectorAll('.application-form input[type="text"], .application-form input[type="email"], .application-form input[type="tel"], .application-form input[type="url"], .application-form textarea');for(const r of n)e.push({label:this.getLabel(r),name:r.name,id:r.id,type:r.type||"text",element:r});const a=document.querySelectorAll(".application-form select");for(const r of a)e.push({label:this.getLabel(r),name:r.name,id:r.id,type:"select",options:this.getOptions(r),element:r});const o=new Set,s=document.querySelectorAll('.application-form input[type="radio"]');for(const r of s)r.name&&!o.has(r.name)&&(o.add(r.name),e.push({label:this.getLabel(r.closest(".application-question")||r),name:r.name,type:"radio",options:this.getOptions(r),element:r}));const l=document.querySelectorAll('.application-form input[type="checkbox"]');for(const r of l)e.push({label:this.getLabel(r),name:r.name,id:r.id,type:"checkbox",element:r});return console.log(`[Lever] Found ${e.length} fields`),e}async fill(e,n){const a=e.element;try{switch(e.type){case"text":case"email":case"tel":case"url":case"textarea":return await this.typeValue(a,n),!0;case"select":return await this.selectOption(a,n);case"radio":return await this.clickOption(e.name,n);case"checkbox":const o=a;return n.toLowerCase()==="yes"||n.toLowerCase()==="true"?o.checked||o.click():o.checked&&o.click(),!0;default:return console.warn(`[Lever] Unknown field type: ${e.type}`),!1}}catch(o){return console.error(`[Lever] Fill failed for ${e.label}`,o),!1}}}class _ extends m{constructor(){super(...arguments);d(this,"name","greenhouse");d(this,"hostPatterns",[/boards\.greenhouse\.io/i,/greenhouse\.io/i])}async getFields(){var s,l;const e=[],n=document.querySelectorAll('#application input:not([type="hidden"]):not([type="submit"]):not([type="file"]), #application textarea');for(const r of n)r.type==="hidden"||r.disabled||e.push({label:this.getLabel(r),name:r.name,id:r.id,type:r.type||"text",element:r});const a=document.querySelectorAll("#application select");for(const r of a)e.push({label:this.getLabel(r),name:r.name,id:r.id,type:"select",options:this.getOptions(r),element:r});const o=document.querySelectorAll(".field");for(const r of o){const c=((l=(s=r.querySelector("label"))==null?void 0:s.textContent)==null?void 0:l.trim())||"",p=r.querySelector("input, select, textarea");p&&c&&!e.some(u=>u.element===p)&&e.push({label:c,name:p.getAttribute("name")||"",id:p.id,type:p.tagName.toLowerCase()==="select"?"select":p.type||"text",options:p.tagName.toLowerCase()==="select"?this.getOptions(p):void 0,element:p})}return console.log(`[Greenhouse] Found ${e.length} fields`),e}async fill(e,n){const a=e.element;try{switch(e.type){case"text":case"email":case"tel":case"url":case"textarea":return await this.typeValue(a,n),!0;case"select":return await this.selectOption(a,n);case"radio":return await this.clickOption(e.name,n);case"checkbox":const o=a;return/yes|true|agree/i.test(n)!==o.checked&&o.click(),!0;default:return await this.typeValue(a,n),!0}}catch(o){return console.error(`[Greenhouse] Fill failed for ${e.label}`,o),!1}}}class B extends m{constructor(){super(...arguments);d(this,"name","workday");d(this,"hostPatterns",[/\.myworkdayjobs\.com/i,/workday\.com/i,/myworkday\.com/i])}async waitUntilReady(){await new Promise(e=>setTimeout(e,1500)),await this.waitForElement('[data-automation-id="jobPostingPage"]',5e3)}async waitForElement(e,n){const a=Date.now();for(;Date.now()-a<n;){const o=document.querySelector(e);if(o)return o;await new Promise(s=>setTimeout(s,200))}return null}async getFields(){var o;const e=[],n=document.querySelectorAll("[data-automation-id]");for(const s of n){const l=s.getAttribute("data-automation-id")||"";if(!l.includes("input")&&!l.includes("select")&&!l.includes("dropdown")&&!l.includes("FormField"))continue;const r=s.querySelector("input, select, textarea");if(!r)continue;const c=s.querySelector('[data-automation-id*="label"], label'),p=((o=c==null?void 0:c.textContent)==null?void 0:o.trim())||this.getLabel(r);let u="text";r.tagName==="SELECT"?u="select":r.type&&(u=r.type),s.querySelector('[data-automation-id*="dropdown"]')!==null&&(u="workday-dropdown"),e.push({label:p,name:r.getAttribute("name")||l,id:r.id||l,type:u,options:u==="select"?this.getOptions(r):void 0,element:r})}const a=document.querySelectorAll('input[data-automation-id]:not([type="hidden"]), textarea[data-automation-id]');for(const s of a)e.some(l=>l.element===s)||e.push({label:this.getLabel(s),name:s.getAttribute("name")||s.getAttribute("data-automation-id")||"",id:s.id,type:s.type||"text",element:s});return console.log(`[Workday] Found ${e.length} fields`),e}async fill(e,n){const a=e.element;try{if(e.type==="workday-dropdown")return await this.fillWorkdayDropdown(a,n);switch(e.type){case"text":case"email":case"tel":case"url":case"textarea":return await this.fillReactInput(a,n),!0;case"select":return await this.selectOption(a,n);case"radio":return await this.clickOption(e.name,n);case"checkbox":const o=a;return/yes|true|agree/i.test(n)!==o.checked&&o.click(),!0;default:return await this.fillReactInput(a,n),!0}}catch(o){return console.error(`[Workday] Fill failed for ${e.label}`,o),!1}}async fillReactInput(e,n){var o,s;e.focus();const a=((o=Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,"value"))==null?void 0:o.set)||((s=Object.getOwnPropertyDescriptor(HTMLTextAreaElement.prototype,"value"))==null?void 0:s.set);a?a.call(e,n):e.value=n,e.dispatchEvent(new Event("input",{bubbles:!0})),e.dispatchEvent(new Event("change",{bubbles:!0})),e.dispatchEvent(new KeyboardEvent("keydown",{bubbles:!0})),e.dispatchEvent(new KeyboardEvent("keyup",{bubbles:!0})),e.blur()}async fillWorkdayDropdown(e,n){var s,l,r;const a=((s=e.closest('[data-automation-id*="dropdown"]'))==null?void 0:s.querySelector("button"))||((l=e.closest(".css-dropdown"))==null?void 0:l.querySelector("button"));if(!a)return console.warn("[Workday] Can't find dropdown trigger"),!1;a.click(),await new Promise(c=>setTimeout(c,300));const o=document.querySelectorAll('[role="option"], [data-automation-id*="option"]');for(const c of o)if((((r=c.textContent)==null?void 0:r.trim())||"").toLowerCase().includes(n.toLowerCase()))return c.click(),!0;return document.body.click(),!1}}class G extends m{constructor(){super(...arguments);d(this,"name","linkedin");d(this,"hostPatterns",[/linkedin\.com/i])}async waitUntilReady(){await new Promise(n=>setTimeout(n,1e3)),document.querySelector(".jobs-easy-apply-modal, [data-test-modal]")||console.warn("[LinkedIn] Easy Apply modal not found")}async getFields(){const e=[],n=document.querySelector(".jobs-easy-apply-modal, [data-test-modal]")||document,a=n.querySelectorAll('input[type="text"], input[type="email"], input[type="tel"], input[type="url"], textarea');for(const c of a)c.type==="hidden"||c.disabled||e.push({label:this.getLinkedInLabel(c),name:c.name,id:c.id,type:c.type||"text",element:c});const o=n.querySelectorAll("select");for(const c of o)e.push({label:this.getLinkedInLabel(c),name:c.name,id:c.id,type:"select",options:this.getOptions(c),element:c});n.querySelectorAll("[data-test-text-selectable-option]");const s=new Set,l=n.querySelectorAll('input[type="radio"]');for(const c of l)if(c.name&&!s.has(c.name)){s.add(c.name);const p=c.closest(".fb-dash-form-element")||c.parentElement;e.push({label:this.getLinkedInLabel(p||c),name:c.name,type:"radio",options:this.getOptions(c),element:c})}const r=n.querySelectorAll('input[type="checkbox"]');for(const c of r)e.push({label:this.getLinkedInLabel(c),name:c.name,id:c.id,type:"checkbox",element:c});return console.log(`[LinkedIn] Found ${e.length} fields`),e}getLinkedInLabel(e){var o;const n=e.closest(".fb-dash-form-element, .jobs-easy-apply-form-section__grouping");if(n){const s=n.querySelector("label, .fb-dash-form-element__label, .t-14");if(s)return((o=s.textContent)==null?void 0:o.trim())||""}const a=e.getAttribute("aria-label");return a?a.trim():this.getLabel(e)}async fill(e,n){const a=e.element;try{switch(e.type){case"text":case"email":case"tel":case"url":case"textarea":return await this.fillLinkedInInput(a,n),!0;case"select":return await this.selectOption(a,n);case"radio":return await this.clickOption(e.name,n);case"checkbox":const o=a;return/yes|true|agree/i.test(n)!==o.checked&&o.click(),!0;default:return await this.fillLinkedInInput(a,n),!0}}catch(o){return console.error(`[LinkedIn] Fill failed for ${e.label}`,o),!1}}async fillLinkedInInput(e,n){var o;e.focus(),e.value="",e.dispatchEvent(new Event("input",{bubbles:!0}));const a=(o=Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,"value"))==null?void 0:o.set;a?a.call(e,n):e.value=n,e.dispatchEvent(new Event("input",{bubbles:!0})),e.dispatchEvent(new Event("change",{bubbles:!0})),await new Promise(s=>setTimeout(s,100)),e.blur()}}class S extends m{constructor(){super(...arguments);d(this,"name","generic");d(this,"hostPatterns",[/.*/])}async getFields(){const e=[],n=document.querySelectorAll('form[id*="apply"], form[id*="application"], form[class*="apply"], form[class*="application"], form, .application-form, #application'),a=n.length>0?n[0]:document,o=a.querySelectorAll('input[type="text"], input[type="email"], input[type="tel"], input[type="url"], input[type="number"], textarea');for(const u of o)this.shouldSkip(u)||e.push({label:this.getLabel(u),name:u.name,id:u.id,type:u.type||"text",element:u});const s=a.querySelectorAll("select");for(const u of s)this.shouldSkip(u)||e.push({label:this.getLabel(u),name:u.name,id:u.id,type:"select",options:this.getOptions(u),element:u});const l=new Set,r=a.querySelectorAll('input[type="radio"]');for(const u of r)u.name&&!l.has(u.name)&&(l.add(u.name),e.push({label:this.getRadioGroupLabel(u),name:u.name,type:"radio",options:this.getOptions(u),element:u}));const c=a.querySelectorAll('input[type="checkbox"]');for(const u of c)this.shouldSkip(u)||e.push({label:this.getLabel(u),name:u.name,id:u.id,type:"checkbox",element:u});const p=a.querySelectorAll('input[type="file"]');for(const u of p)e.push({label:this.getLabel(u)||"Resume/CV Upload",name:u.name,id:u.id,type:"file",element:u});return console.log(`[Generic] Found ${e.length} fields`),e}shouldSkip(e){var s,l;if(e.type==="hidden"||e.disabled)return!0;const n=window.getComputedStyle(e);if(n.display==="none"||n.visibility==="hidden")return!0;const a=((s=e.name)==null?void 0:s.toLowerCase())||"",o=((l=e.id)==null?void 0:l.toLowerCase())||"";return!!(a.includes("captcha")||o.includes("captcha")||a.includes("search")||o.includes("search"))}getRadioGroupLabel(e){var o,s;const n=e.closest("fieldset");if(n){const l=n.querySelector("legend");if(l)return((o=l.textContent)==null?void 0:o.trim())||""}const a=e.closest(".form-group, .field, .question");if(a){const l=a.querySelector("label, .label, h3, h4");if(l)return((s=l.textContent)==null?void 0:s.trim())||""}return this.getLabel(e)}async fill(e,n){const a=e.element;try{switch(e.type){case"text":case"email":case"tel":case"url":case"number":case"textarea":return await this.typeValue(a,n),!0;case"select":return await this.selectOption(a,n);case"radio":return await this.clickOption(e.name,n);case"checkbox":const o=a;return/yes|true|agree|accept/i.test(n)!==o.checked&&o.click(),!0;case"file":return console.log(`[Generic] File input detected: ${e.label}`),!1;default:return await this.typeValue(a,n),!0}}catch(o){return console.error(`[Generic] Fill failed for ${e.label}`,o),!1}}}const D=[new B,new G,new M,new _,new S];function J(i=window.location.href){for(const t of D)if(t.matches(i))return console.log(`[Registry] Using adapter: ${t.name}`),t;return new S}const U=75;class Y{constructor(t,e,n){d(this,"matcher");d(this,"onProgress");this.profile=t,this.matcher=new z(t,e),this.onProgress=n}async fillForm(){var s;const t=Date.now(),e=[],n=J();console.log(`[Filler] Using adapter: ${n.name}`),await n.waitUntilReady();const a=await n.getFields();console.log(`[Filler] Found ${a.length} fields`);for(let l=0;l<a.length;l++){const r=a[l];(s=this.onProgress)==null||s.call(this,l+1,a.length,r,"filling"),this.highlightField(r.element,"active");try{const c=await this.matcher.resolve(r),p=await this.handleMatch(r,c,n);e.push(p),this.highlightField(r.element,p.status)}catch(c){console.error(`[Filler] Error on field: ${r.label}`,c),e.push({field:r,status:"failed",reason:"exception"}),this.highlightField(r.element,"failed")}await this.delay(U)}const o={total:a.length,filled:e.filter(l=>l.status==="filled").length,skipped:e.filter(l=>l.status==="skipped").length,failed:e.filter(l=>l.status==="failed").length,needsUser:e.filter(l=>l.status==="needs-user").length,timeMs:Date.now()-t,results:e};return console.log(`[Filler] Complete: ${o.filled}/${o.total} in ${o.timeMs}ms`),o}async handleMatch(t,e,n){if(e.action==="skip")return{field:t,status:"skipped",reason:e.reason};if(e.action==="ask")return{field:t,status:"needs-user",reason:e.reason};if(e.action==="manual"||e.value===null)return{field:t,status:"failed",reason:"no-match",tier:e.tier};let a=e.value;return e.transform&&b[e.transform]&&(a=b[e.transform](t.options||[],e.value)),a=String(a),await n.fill(t,a)?{field:t,status:"filled",tier:e.tier,strategy:e.strategy,value:a}:{field:t,status:"failed",tier:e.tier,strategy:e.strategy,reason:"fill-failed"}}highlightField(t,e){switch(t.classList.remove("jf-field-active","jf-field-success","jf-field-failed","jf-field-skipped","jf-field-warning"),e){case"active":t.classList.add("jf-field-active");break;case"filled":t.classList.add("jf-field-success");break;case"failed":t.classList.add("jf-field-failed");break;case"skipped":t.classList.add("jf-field-skipped");break;case"needs-user":t.classList.add("jf-field-warning");break}}delay(t){return new Promise(e=>setTimeout(e,t))}}class V{constructor(){d(this,"container",null);d(this,"progressBar",null);d(this,"statusText",null);d(this,"countText",null)}injectStyles(){if(document.getElementById("jf-overlay-styles"))return;const t=document.createElement("style");t.id="jf-overlay-styles",t.textContent=`
      /* Progress Widget */
      .jf-progress-widget {
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 220px;
        padding: 14px 18px;
        background: rgba(255, 255, 255, 0.97);
        backdrop-filter: blur(10px);
        border-radius: 14px;
        box-shadow: 0 4px 24px rgba(0, 0, 0, 0.12);
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        z-index: 2147483647;
        transition: all 0.3s ease;
      }

      .jf-progress-widget.jf-minimized {
        width: auto;
        padding: 10px 14px;
      }

      .jf-progress-header {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 10px;
      }

      .jf-progress-icon {
        font-size: 16px;
        animation: jf-spin 1s linear infinite;
      }

      .jf-progress-title {
        font-size: 13px;
        font-weight: 600;
        color: #1a1a1a;
      }

      .jf-progress-count {
        font-size: 12px;
        color: #666;
        margin-left: auto;
      }

      .jf-progress-bar-container {
        height: 4px;
        background: #e8e8e8;
        border-radius: 2px;
        overflow: hidden;
      }

      .jf-progress-bar-fill {
        height: 100%;
        background: linear-gradient(90deg, #4CAF50, #8BC34A);
        border-radius: 2px;
        transition: width 0.3s ease;
        width: 0%;
      }

      .jf-progress-status {
        font-size: 11px;
        color: #888;
        margin-top: 8px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      /* Summary */
      .jf-summary {
        margin-top: 12px;
        padding-top: 12px;
        border-top: 1px solid #eee;
      }

      .jf-summary-stats {
        display: flex;
        gap: 12px;
        font-size: 11px;
      }

      .jf-stat {
        display: flex;
        align-items: center;
        gap: 4px;
      }

      .jf-stat-icon {
        font-size: 12px;
      }

      /* Field Highlights */
      .jf-field-active {
        outline: 2px solid #2196F3 !important;
        outline-offset: 2px;
        animation: jf-pulse 1s ease-in-out infinite;
      }

      .jf-field-success {
        outline: 2px solid #4CAF50 !important;
        outline-offset: 2px;
      }

      .jf-field-failed {
        outline: 2px solid #f44336 !important;
        outline-offset: 2px;
      }

      .jf-field-skipped {
        outline: 2px solid #9E9E9E !important;
        outline-offset: 2px;
      }

      .jf-field-warning {
        outline: 2px solid #FF9800 !important;
        outline-offset: 2px;
      }

      @keyframes jf-pulse {
        0%, 100% { outline-color: #2196F3; }
        50% { outline-color: #64B5F6; }
      }

      @keyframes jf-spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
      }
    `,document.head.appendChild(t)}show(){this.injectStyles(),!this.container&&(this.container=document.createElement("div"),this.container.className="jf-progress-widget",this.container.innerHTML=`
      <div class="jf-progress-header">
        <span class="jf-progress-icon">‚ö°</span>
        <span class="jf-progress-title">Filling...</span>
        <span class="jf-progress-count" id="jf-count">0/0</span>
      </div>
      <div class="jf-progress-bar-container">
        <div class="jf-progress-bar-fill" id="jf-bar"></div>
      </div>
      <div class="jf-progress-status" id="jf-status">Starting...</div>
    `,document.body.appendChild(this.container),this.progressBar=document.getElementById("jf-bar"),this.statusText=document.getElementById("jf-status"),this.countText=document.getElementById("jf-count"))}update(t,e,n,a){var s;this.container||this.show();const o=Math.round(t/e*100);if(this.progressBar&&(this.progressBar.style.width=`${o}%`),this.countText&&(this.countText.textContent=`${t}/${e}`),this.statusText){const l=((s=n.label)==null?void 0:s.slice(0,30))||"Field";this.statusText.textContent=`${a}: ${l}...`}}showSummary(t){if(!this.container)return;const e=this.container.querySelector(".jf-progress-header");e&&(e.innerHTML=`
        <span class="jf-progress-icon" style="animation: none">‚úÖ</span>
        <span class="jf-progress-title">Complete!</span>
        <span class="jf-progress-count">${t.timeMs}ms</span>
      `),this.progressBar&&(this.progressBar.style.width="100%"),this.statusText&&(this.statusText.innerHTML=`
        <div class="jf-summary-stats">
          <span class="jf-stat"><span class="jf-stat-icon">‚úÖ</span> ${t.filled}</span>
          <span class="jf-stat"><span class="jf-stat-icon">‚è≠Ô∏è</span> ${t.skipped}</span>
          <span class="jf-stat"><span class="jf-stat-icon">‚ùå</span> ${t.failed}</span>
          ${t.needsUser>0?`<span class="jf-stat"><span class="jf-stat-icon">‚ö†Ô∏è</span> ${t.needsUser}</span>`:""}
        </div>
      `),setTimeout(()=>this.hide(),5e3)}hide(){this.container&&(this.container.remove(),this.container=null),document.querySelectorAll(".jf-field-active, .jf-field-success, .jf-field-failed, .jf-field-skipped, .jf-field-warning").forEach(t=>{t.classList.remove("jf-field-active","jf-field-success","jf-field-failed","jf-field-skipped","jf-field-warning")})}}const y=new V,H="jobfiller-files",K=1,f="files";let g=null;async function L(){return g||new Promise((i,t)=>{const e=indexedDB.open(H,K);e.onerror=()=>t(e.error),e.onsuccess=()=>{g=e.result,i(g)},e.onupgradeneeded=n=>{const a=n.target.result;a.objectStoreNames.contains(f)||a.createObjectStore(f,{keyPath:"id"})}})}async function W(i,t,e){const n=await L(),a={id:i,blob:t,name:e,type:t.type,size:t.size,updatedAt:Date.now()};return new Promise((o,s)=>{const c=n.transaction(f,"readwrite").objectStore(f).put(a);c.onerror=()=>s(c.error),c.onsuccess=()=>{console.log(`[Storage] Stored file: ${i} (${e}, ${t.size} bytes)`),o()}})}async function Q(i){const t=await L();return new Promise((e,n)=>{const s=t.transaction(f,"readonly").objectStore(f).get(i);s.onerror=()=>n(s.error),s.onsuccess=()=>e(s.result||null)})}async function X(i,t,e,n){const a=new Blob([t],{type:n});return W(i,a,e)}const Z="resume";async function ee(i){try{const t=await Q(Z);if(!t)return console.log("[Resume] No resume stored"),!1;const e=new File([t.blob],t.name,{type:t.type,lastModified:t.updatedAt}),n=new DataTransfer;return n.items.add(e),i.files=n.files,i.dispatchEvent(new Event("change",{bubbles:!0})),i.dispatchEvent(new Event("input",{bubbles:!0})),console.log(`[Resume] Attached: ${t.name} (${t.size} bytes)`),!0}catch(t){return console.error("[Resume] Failed to attach:",t),!1}}function te(){const i=document.querySelectorAll('input[type="file"]');return Array.from(i).filter(t=>{var o,s;const e=((o=t.accept)==null?void 0:o.toLowerCase())||"",n=(t.getAttribute("aria-label")||((s=t.closest("label"))==null?void 0:s.textContent)||"").toLowerCase();return n.includes("resume")||n.includes("cv")||e.includes("pdf")||e.includes("doc")})}async function ne(){const i=te();let t=0;for(const e of i)await ee(e)&&t++;return t}console.log("[JobFiller Pro V2] Content Script Loaded üöÄ");chrome.runtime.onMessage.addListener((i,t,e)=>{switch(console.log("[Listener] Message received:",i.type),i.type){case"PING":e({status:"PONG"});break;case"FILL_FORM":return oe().then(e),!0;case"GET_STATUS":return ae().then(e),!0;default:console.log("[Listener] Unknown message type:",i.type)}});window.addEventListener("message",async i=>{const t=i.data;if(!(!t||!t.type))switch(console.log("[Listener] Window message:",t.type),t.type){case"JOBFILLER_AUTH":case"JOBFILLER_SYNC":await ie(t);break;case"JOBFILLER_PROFILE":await re(t.payload);break;case"JOBFILLER_SESSION":await le(t.payload);break;case"JOBFILLER_SETTINGS":await ce(t.payload);break;case"JOBFILLER_PING":window.postMessage({type:"JOBFILLER_PONG",installed:!0},"*");break}});async function oe(){try{const i=await chrome.storage.local.get(["profile","auth"]);if(!i.profile)return{success:!1,error:"No profile synced. Please sync from dashboard first."};const t=i.profile;y.show();const n=await new Y(t,void 0,(a,o,s,l)=>{y.update(a,o,s,l)}).fillForm();return await ne(),y.showSummary(n),await se(n.filled),{success:!0,filled:n.filled}}catch(i){return console.error("[Listener] Fill error:",i),y.hide(),{success:!1,error:String(i)}}}async function ie(i){try{const{session:t,profile:e,resume:n,settings:a}=i.payload||i;t&&(await chrome.storage.local.set({auth:{uid:t.uid,email:t.email,displayName:t.displayName,photoURL:t.photoURL,token:t.token,expiresAt:t.expiresAt||Date.now()+36e5,syncedAt:Date.now()}}),console.log("[Sync] Auth stored for:",t.email)),e&&(await chrome.storage.local.set({profile:e}),console.log("[Sync] Profile stored")),n&&n.buffer&&(await X("resume",n.buffer,n.name||"resume.pdf",n.type||"application/pdf"),await chrome.storage.local.set({resumeInfo:{name:n.name,size:n.buffer.byteLength,type:n.type}}),console.log("[Sync] Resume stored:",n.name)),a&&(await chrome.storage.local.set({settings:a}),console.log("[Sync] Settings stored")),window.postMessage({type:"JOBFILLER_SYNC_SUCCESS"},"*")}catch(t){console.error("[Sync] Error:",t),window.postMessage({type:"JOBFILLER_SYNC_ERROR",error:String(t)},"*")}}async function ae(){var t;const i=await chrome.storage.local.get(["auth","profile","resumeInfo","stats"]);return{isAuthenticated:!!((t=i.auth)!=null&&t.uid),hasProfile:!!i.profile,hasResume:!!i.resumeInfo,stats:i.stats||{filledToday:0,cached:0}}}async function se(i){const e=(await chrome.storage.local.get(["stats"])).stats||{filledToday:0,cached:0,totalFilled:0};e.filledToday=(e.filledToday||0)+i,e.totalFilled=(e.totalFilled||0)+i,await chrome.storage.local.set({stats:e})}async function re(i){try{const{profile:t}=i||{};t&&(await chrome.storage.local.set({profile:t}),console.log("[Sync] Profile stored from dashboard")),window.postMessage({type:"JOBFILLER_PROFILE_SUCCESS"},"*")}catch(t){console.error("[Sync] Profile error:",t),window.postMessage({type:"JOBFILLER_PROFILE_ERROR",error:String(t)},"*")}}async function le(i){var t,e;try{const{uid:n,projectId:a,session:o}=i||{};o&&(await chrome.storage.local.set({auth:{uid:n||o.uid,email:((t=o.personalInfo)==null?void 0:t.email)||o.email||"",displayName:((e=o.personalInfo)==null?void 0:e.name)||o.displayName||"",syncedAt:Date.now()},session:o,profile:o}),console.log("[Sync] Session stored from flash")),window.postMessage({type:"JOBFILLER_SESSION_SUCCESS"},"*")}catch(n){console.error("[Sync] Session error:",n),window.postMessage({type:"JOBFILLER_SESSION_ERROR",error:String(n)},"*")}}async function ce(i){try{const t=i||{};await chrome.storage.local.set({settings:t}),console.log("[Sync] Settings stored from admin"),window.postMessage({type:"JOBFILLER_SETTINGS_SUCCESS"},"*")}catch(t){console.error("[Sync] Settings error:",t),window.postMessage({type:"JOBFILLER_SETTINGS_ERROR",error:String(t)},"*")}}console.log("[JobFiller Pro V2] Content Script Loading... ‚ö°");window.addEventListener("message",i=>{var t;((t=i.data)==null?void 0:t.type)==="JOBFILLER_PING"&&(console.log("[JobFiller Pro V2] PING received, responding with PONG"),window.postMessage({type:"JOBFILLER_PONG",installed:!0},"*"))});console.log("[JobFiller Pro V2] Content Script Initialized ‚ö°");
})()
