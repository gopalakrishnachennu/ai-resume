(function(){var ye=Object.defineProperty;var ge=(s,t,e)=>t in s?ye(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var b=(s,t,e)=>ge(s,typeof t!="symbol"?t+"":t,e);const D={boolToYesNo:(s,t)=>{if(!s||s.length===0)return t?"Yes":"No";const e=s.find(c=>/^(yes|yep|correct|true)$/i.test(c.trim())),o=s.find(c=>/yes|agree/i.test(c)),n=e||o||s[0],a=s.find(c=>/^(no|nope|incorrect|false)$/i.test(c.trim())),r=s.find(c=>/no|disagree/i.test(c)),i=a||r||s[1]||s[0];return t?n:i},authToOption:(s,t)=>{if(!s||s.length===0)return"Yes";const e=t.toLowerCase(),n={citizen:/citizen|authorized|without.*sponsor|permanent.*resident/i,greencard:/green.*card|permanent.*resident|authorized/i,visa:/visa|require.*sponsor|sponsorship/i,other:/other|not.*authorized/i}[e]||/authorized/i;return s.find(a=>n.test(a))??s[0]},formatSalary:(s,t)=>{var e;if(!s||s.length===0)return t.toString();for(const o of s)if((e=o.match(/\d+/g))==null||e.map(n=>parseInt(n)),o.includes((t/1e3).toString()))return o;return s.find(o=>o.includes(t.toString()))??s[0]},formatPhone:(s,t)=>t,toString:(s,t)=>String(t),genderToPronouns:(s,t)=>{const e=(t||"").toLowerCase();console.log(`[Transform] genderToPronouns: gender="${t}", options=`,s);let o="he";if(e.includes("female")||e.includes("woman")?o="she":e.includes("non-binary")||e.includes("other")||e.includes("prefer not")?o="they":(e.includes("male")||e.includes("man"))&&(o="he"),console.log(`[Transform] Preferred pronoun keyword: "${o}"`),s&&s.length>0){const n=s.find(a=>{const r=a.toLowerCase();return r.startsWith(o)||r.includes(`${o}/`)||r.includes(`/${o}`)});if(n)return console.log(`[Transform] Matched option: "${n}"`),n;console.warn(`[Transform] No match found in options for "${o}"`)}return o==="he"?"He/Him/His":o==="she"?"She/Her/Hers":"They/Them/Theirs"},isUsLocation:(s,t,e)=>{var c,l,h,u;const o=(t||"").toLowerCase().trim(),n=["al","ak","az","ar","ca","co","ct","de","fl","ga","hi","id","il","in","ia","ks","ky","la","me","md","ma","mi","mn","ms","mo","mt","ne","nv","nh","nj","nm","ny","nc","nd","oh","ok","or","pa","ri","sc","sd","tn","tx","ut","vt","va","wa","wv","wi","wy","alabama","alaska","arizona","arkansas","california","colorado","connecticut","delaware","florida","georgia","hawaii","idaho","illinois","indiana","iowa","kansas","kentucky","louisiana","maine","maryland","massachusetts","michigan","minnesota","mississippi","missouri","montana","nebraska","nevada","new hampshire","new jersey","new mexico","new york","north carolina","north dakota","ohio","oklahoma","oregon","pennsylvania","rhode island","south carolina","south dakota","tennessee","texas","utah","vermont","virginia","washington","west virginia","wisconsin","wyoming","dc","district of columbia"],a=o==="usa"||o==="us"||o==="united states"||o==="united states of america"||o==="america"||o.includes("united states");let r=!1;if((l=(c=e==null?void 0:e.identity)==null?void 0:c.location)!=null&&l.state){const f=e.identity.location.state.toLowerCase().trim();r=n.includes(f)}const i=a||r;return console.log(`[Transform] isUsLocation: country="${t}", state="${(u=(h=e==null?void 0:e.identity)==null?void 0:h.location)==null?void 0:u.state}", result=${i}`),D.boolToYesNo(s,i)}},C={"first name":{path:"identity.firstName"},"given name":{path:"identity.firstName"},first:{path:"identity.firstName"},"last name":{path:"identity.lastName"},"family name":{path:"identity.lastName"},surname:{path:"identity.lastName"},last:{path:"identity.lastName"},"full name":{path:"identity.fullName"},name:{path:"identity.fullName"},email:{path:"identity.email"},"email address":{path:"identity.email"},phone:{path:"identity.phone",transform:"formatPhone"},"phone number":{path:"identity.phone",transform:"formatPhone"},mobile:{path:"identity.phone",transform:"formatPhone"},"contact number":{path:"identity.phone",transform:"formatPhone"},address:{path:"identity.location.address"},"street address":{path:"identity.location.address"},city:{path:"identity.location.city"},town:{path:"identity.location.city"},state:{path:"identity.location.state"},province:{path:"identity.location.state"},region:{path:"identity.location.state"},zip:{path:"identity.location.zip"},"zip code":{path:"identity.location.zip"},"postal code":{path:"identity.location.zip"},country:{path:"identity.location.country"},linkedin:{path:"identity.linkedin"},"linkedin url":{path:"identity.linkedin"},"linkedin profile":{path:"identity.linkedin"},github:{path:"identity.github"},"github url":{path:"identity.github"},portfolio:{path:"identity.portfolio"},website:{path:"identity.website"},"personal website":{path:"identity.website"},"are you legally authorized to work in the united states?":{path:"authorization.workAuth",transform:"authToOption"},"are you legally authorized to work in the country where this job is located?":{path:"authorization.workAuth",transform:"authToOption"},"work authorization":{path:"authorization.workAuth",transform:"authToOption"},"will you now or in the future require sponsorship for employment visa status?":{path:"authorization.needSponsor",transform:"boolToYesNo"},"do you require sponsorship?":{path:"authorization.needSponsor",transform:"boolToYesNo"},sponsorship:{path:"authorization.needSponsor",transform:"boolToYesNo"},"are you willing to relocate?":{path:"authorization.willingToRelocate",transform:"boolToYesNo"},"willing to relocate":{path:"authorization.willingToRelocate",transform:"boolToYesNo"},relocation:{path:"authorization.willingToRelocate",transform:"boolToYesNo"},"are you located in the united states?":{path:"identity.location.country",transform:"isUsLocation"},"are you located in the us?":{path:"identity.location.country",transform:"isUsLocation"},"are you located in the usa?":{path:"identity.location.country",transform:"isUsLocation"},"are you currently located in the united states?":{path:"identity.location.country",transform:"isUsLocation"},"do you reside in the united states?":{path:"identity.location.country",transform:"isUsLocation"},"are you based in the united states?":{path:"identity.location.country",transform:"isUsLocation"},"are you a us resident?":{path:"identity.location.country",transform:"isUsLocation"},"are you currently legally eligible to work in the united states":{path:"authorization.authorized",transform:"boolToYesNo"},"are you legally eligible to work in the united states":{path:"authorization.authorized",transform:"boolToYesNo"},"are you authorized to work in the united states":{path:"authorization.authorized",transform:"boolToYesNo"},"are you authorized to work in the us":{path:"authorization.authorized",transform:"boolToYesNo"},"authorized to work":{path:"authorization.authorized",transform:"boolToYesNo"},"legally authorized to work":{path:"authorization.authorized",transform:"boolToYesNo"},"will you now or in the future require visa sponsorship":{path:"authorization.needSponsor",transform:"boolToYesNo"},"will you require visa sponsorship":{path:"authorization.needSponsor",transform:"boolToYesNo"},"do you require visa sponsorship":{path:"authorization.needSponsor",transform:"boolToYesNo"},"require sponsorship":{path:"authorization.needSponsor",transform:"boolToYesNo"},"need sponsorship":{path:"authorization.needSponsor",transform:"boolToYesNo"},"visa sponsorship":{path:"authorization.needSponsor",transform:"boolToYesNo"},"what city & state do you currently reside in":{path:"identity.location.full"},"what city and state do you currently reside in":{path:"identity.location.full"},"city and state":{path:"identity.location.full"},"city & state":{path:"identity.location.full"},"current city":{path:"identity.location.city"},"current state":{path:"identity.location.state"},"desired salary":{path:"role.salaryMin",transform:"formatSalary"},"expected salary":{path:"role.salaryMin",transform:"formatSalary"},"salary expectation":{path:"role.salaryMin",transform:"formatSalary"},"preferred start date":{path:"role.startDate"},"start date":{path:"role.startDate"},"notice period":{path:"role.noticePeriod"},"how did you hear about us?":{path:"meta.source",transform:"sourceToOption"},gender:{path:"compliance.gender"},"what is your gender?":{path:"compliance.gender"},pronouns:{path:"identity.pronouns",inferFrom:"compliance.gender",transform:"genderToPronouns"},"your pronouns":{path:"identity.pronouns",inferFrom:"compliance.gender",transform:"genderToPronouns"},"preferred pronouns":{path:"identity.pronouns",inferFrom:"compliance.gender",transform:"genderToPronouns"},race:{path:"compliance.ethnicity"},"race/ethnicity":{path:"compliance.ethnicity"},ethnicity:{path:"compliance.ethnicity"},"veteran status":{path:"compliance.veteran"},"are you a veteran?":{path:"compliance.veteran"},"disability status":{path:"compliance.disability"},"are you disabled?":{path:"compliance.disability"},school:{path:"education.history.0.school"},university:{path:"education.history.0.school"},degree:{path:"education.history.0.degree"},major:{path:"education.history.0.fieldOfStudy"},"field of study":{path:"education.history.0.fieldOfStudy"},"current company":{path:"experience.currentCompany"},"current employer":{path:"experience.currentCompany"},"current title":{path:"experience.currentTitle"},"job title":{path:"experience.currentTitle"}},oe=[{regex:/first\s*name|given\s*name/i,path:"identity.firstName"},{regex:/last\s*name|family\s*name|surname/i,path:"identity.lastName"},{regex:/full\s*name/i,path:"identity.fullName"},{regex:/phone|mobile|cell/i,path:"identity.phone",transform:"formatPhone"},{regex:/email/i,path:"identity.email"},{regex:/address|street/i,path:"identity.location.address"},{regex:/city|town/i,path:"identity.location.city"},{regex:/zip|postal/i,path:"identity.location.zip"},{regex:/linkedin/i,path:"identity.linkedin"},{regex:/github/i,path:"identity.github"},{regex:/portfolio|website/i,path:"identity.portfolio"},{regex:/salary|compensation|pay|wage/i,path:"role.salaryMin",transform:"formatSalary"},{regex:/start\s*date/i,path:"role.startDate"},{regex:/notice/i,path:"role.noticePeriod"},{regex:/authorized.*work|legal.*work|eligible.*work/i,path:"authorization.workAuth",transform:"authToOption"},{regex:/sponsor/i,path:"authorization.needSponsor",transform:"boolToYesNo"},{regex:/relocat/i,path:"authorization.willingToRelocate",transform:"boolToYesNo"},{regex:/gender|sex/i,path:"compliance.gender"},{regex:/race|ethnicity/i,path:"compliance.ethnicity"},{regex:/veteran/i,path:"compliance.veteran"},{regex:/disability/i,path:"compliance.disability"}];function P(s,t="all",e=5){const o=s==null?void 0:s.skills;if(!o)return[];if(typeof o=="string")return o.split(",").map(n=>n.trim()).filter(Boolean).slice(0,e);if(typeof o=="object"){const n=Array.isArray(o.technical)?o.technical:[],a=Array.isArray(o.soft)?o.soft:[];return t==="technical"?n.slice(0,e):t==="soft"?a.slice(0,e):[...n,...a].slice(0,e)}return[]}const we=[{patterns:[/why.*work.*here/i,/why.*interested/i,/why.*apply/i,/what.*attract.*company/i,/why.*join.*us/i],generate:(s,t)=>{var a;const e=(t==null?void 0:t.jobTitle)||((a=s.role)==null?void 0:a.targetTitle)||"this role",o=(t==null?void 0:t.company)||"your organization";return`I am excited about the opportunity to bring my expertise in ${P(s,"technical",3).join(", ")||"my technical expertise"} to ${o}. The ${e} position aligns perfectly with my career goals, and I am drawn to the company's mission and values. I believe my ${s.experience.totalYears||"several"} years of experience would allow me to make meaningful contributions to your team.`}},{patterns:[/tell.*about.*yourself/i,/describe.*yourself/i,/professional.*summary/i,/about.*you/i,/introduce.*yourself/i],generate:s=>{var n,a,r;const t=((n=s.experience)==null?void 0:n.totalYears)||"several",e=((a=s.role)==null?void 0:a.targetTitle)||((r=s.experience)==null?void 0:r.currentTitle)||"professional",o=P(s,"technical",4).join(", ")||"various technologies";return`I am a ${e} with ${t} years of experience. My core competencies include ${o}. I am passionate about delivering high-quality work and continuously learning new technologies.`}},{patterns:[/what.*strength/i,/your.*strength/i,/greatest.*strength/i,/top.*skill/i],generate:s=>{const t=P(s,"technical",3),e=P(s,"soft",2);return`My key strengths include ${[...t,...e].join(", ")||"problem-solving and technical expertise"}. I excel at problem-solving and collaborating with cross-functional teams to deliver results.`}},{patterns:[/what.*weakness/i,/your.*weakness/i,/area.*improvement/i,/what.*improve/i],generate:()=>"I sometimes focus too much on details, which I've learned to balance by setting clear priorities. I've been working on delegating more effectively and trusting my team members with responsibilities."},{patterns:[/where.*5.*year/i,/where.*five.*year/i,/career.*goal/i,/long.*term.*goal/i,/future.*plan/i],generate:s=>`In five years, I see myself in a ${s.role.targetTitle||"leadership role"} where I can drive strategic initiatives and mentor junior team members. I am committed to continuous learning and growing with an organization that values innovation and professional development.`},{patterns:[/why.*leaving/i,/why.*leave.*current/i,/reason.*change/i,/why.*looking/i],generate:()=>"I am seeking new challenges and opportunities for growth that align with my career goals. While I've learned a great deal in my current role, I am excited about the possibility of contributing to a new team and expanding my skill set."},{patterns:[/salary.*expect/i,/compensation.*expect/i,/desired.*salary/i,/what.*salary/i],generate:s=>{const t=s.role.salaryMin,e=s.role.salaryMax;return t&&e?`My salary expectation is in the range of $${t.toLocaleString()} to $${e.toLocaleString()}, depending on the total compensation package and benefits.`:"I am open to discussing compensation based on the responsibilities of the role and the overall benefits package."}},{patterns:[/cover.*letter/i,/additional.*information/i,/anything.*else/i,/what.*else.*know/i],generate:(s,t)=>{const e=(t==null?void 0:t.company)||"your organization",o=P(s,"technical",3).join(", ")||"my technical expertise";return`I am enthusiastic about the opportunity to join ${e}. With my background in ${o} and proven track record of delivering results, I am confident I would be a strong addition to your team. I look forward to discussing how I can contribute to your success.`}},{patterns:[/how.*hear.*about/i,/where.*find.*job/i,/source.*application/i,/how.*discover/i],generate:()=>"LinkedIn"}];function ne(s){const t=s.toLowerCase().trim();for(const e of we)if(e.patterns.some(o=>o.test(t)))return e;return null}function se(s,t,e){return s.generate(t,e)}function G(s,t){if(s===t)return 0;if(s.length===0)return t.length;if(t.length===0)return s.length;const e=s.length,o=t.length;if(e>o)return G(t,s);const n=new Int32Array(e+1);for(let a=0;a<=e;a++)n[a]=a;for(let a=1;a<=o;a++){let r=a;for(let i=1;i<=e;i++){let c;t[a-1]===s[i-1]?c=n[i-1]:c=Math.min(n[i-1]+1,Math.min(r+1,n[i]+1)),n[i-1]=r,r=c}n[e]=r}return n[e]}const j="jobfiller_ai_cache",be=[/describe/i,/explain/i,/tell us/i,/briefly/i,/how have you/i,/how would you/i,/rate your experience/i,/what technical tools/i,/comfortable with/i];function de(s){return!be.some(t=>t.test(s))}async function ae(s){if(!de(s))return console.log(`[Cache Skip] Question too specific to cache: "${s.substring(0,50)}..."`),null;const t=fe(s);try{const n=((await chrome.storage.local.get(j))[j]||{})[t];if(n)return console.log(`[Cache Hit] "${s}" -> "${n.answer}"`),n.answer}catch(e){console.warn("Cache read failed",e)}return null}async function pe(s,t){if(!de(s)){console.log(`[Cache Skip Save] Not caching: "${s.substring(0,50)}..."`);return}const e=fe(s),o={question:s,answer:t,timestamp:Date.now()};try{const a=(await chrome.storage.local.get(j))[j]||{},r=Object.keys(a);if(r.length>500){const i=r.reduce((c,l)=>a[c].timestamp<a[l].timestamp?c:l);delete a[i]}a[e]=o,await chrome.storage.local.set({[j]:a})}catch(n){console.warn("Cache write failed",n)}}function fe(s){return s.toLowerCase().replace(/[^a-z0-9]/g,"")}const xe="llama-3.1-8b-instant",U=3,re=2e3;async function Se(s,t){var c,l,h,u,f,p;const{settings:e}=await chrome.storage.local.get("settings"),o=e==null?void 0:e.groqApiKey;if(!o)throw console.warn("[Groq] No API key configured"),new Error("Groq API Key missing");const n=JSON.stringify(t.profile,null,2),a=(c=t.options)!=null&&c.length?`Choose strictly from these options: ${JSON.stringify(t.options)}`:"Answer concisely in 1-2 sentences.",r=`You are a helpful assistant filling out a job application. 
User Profile: ${n}

Rules:
1. Be truthful based on profile.
2. If info is missing, say "N/A".
3. Output ONLY the answer value, no explanation or preamble.
4. For Yes/No questions, respond with just "Yes" or "No".
5. For salary questions, respond with just the number like "$140,000".
6. ${a}`;let i=null;for(let m=1;m<=U;m++)try{const d=await fetch("https://api.groq.com/openai/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify({model:(e==null?void 0:e.groqModel)||xe,messages:[{role:"system",content:r},{role:"user",content:`Question: ${s}`}],temperature:.2,max_tokens:150})});if(d.status===429){console.warn(`[Groq] Rate limited (attempt ${m}/${U}). Waiting ${re}ms...`),await new Promise(x=>setTimeout(x,re*m)),i=new Error("Rate limited");continue}if(!d.ok){const x=await d.json().catch(()=>({}));throw new Error(`Groq API Error ${d.status}: ${((l=x==null?void 0:x.error)==null?void 0:l.message)||d.statusText}`)}const y=await d.json();if(y.error)throw new Error(`Groq Error: ${y.error.message}`);const g=(p=(f=(u=(h=y.choices)==null?void 0:h[0])==null?void 0:u.message)==null?void 0:f.content)==null?void 0:p.trim();if(!g)throw new Error("Empty response from Groq");return console.log(`[Groq] Success for "${s.substring(0,30)}...": ${g.substring(0,50)}`),g}catch(d){i=d,console.error(`[Groq] Attempt ${m} failed:`,d),m<U&&await new Promise(y=>setTimeout(y,1e3))}throw i||new Error("Groq failed after max retries")}async function ke(s,t){var i,c;if(!((i=window.ai)!=null&&i.languageModel))throw new Error("Gemini Nano not supported");if((await window.ai.languageModel.capabilities()).available==="no")throw new Error("Gemini Nano not available");const o=await window.ai.languageModel.create(),n={name:t.profile.identity.fullName,email:t.profile.identity.email,skills:t.profile.skills.technical.slice(0,10),job:t.profile.role.targetTitle,company:t.profile.experience.currentCompany},a=(c=t.options)!=null&&c.length?`Options: ${JSON.stringify(t.options)}`:"",r=`
Context: ${JSON.stringify(n)}
Question: ${s}
${a}
Answer with only the value.
`;try{return(await o.prompt(r)).trim()}catch(l){throw console.error("Nano failed",l),l}}const ie=[/ssn|social\s*security/i,/bank|routing/i,/password/i],le=[/background\s*check/i,/drug\s*test/i,/consent/i];class Le{constructor(t,e){b(this,"jobContext");this.profile=t,this.jobContext=e}async resolve(t){const e=t.label.toLowerCase().trim();if(ie.some(n=>n.test(e)))return{tier:0,value:null,confidence:1,strategy:"security-block",action:"skip",reason:"sensitive-data"};if(le.some(n=>n.test(e)))return{tier:0,value:null,confidence:1,strategy:"user-consent",action:"ask",reason:"requires-consent"};if(t.element.value,C[e]){const n=C[e];let a=this.getValueByPath(n.path);if(!a&&n.inferFrom&&(a=this.getValueByPath(n.inferFrom)),a)return{tier:2,value:a,confidence:1,strategy:"canonical-exact",transform:n.transform}}for(const[n,a]of Object.entries(C)){if(Math.abs(e.length-n.length)>3)continue;if(G(e,n)<=2){let i=this.getValueByPath(a.path);if(!i&&a.inferFrom&&(i=this.getValueByPath(a.inferFrom)),i)return{tier:3,value:i,confidence:.9,strategy:`fuzzy-canonical(${n})`,transform:a.transform}}}for(const n of oe)if(n.regex.test(e)){const a=this.getValueByPath(n.path);if(a)return{tier:4,value:a,confidence:.85,strategy:"regex-pattern",transform:n.transform}}const o=ne(t.label);if(o)return{tier:5,value:se(o,this.profile,this.jobContext),confidence:.8,strategy:"template-match"};if(e.length>2){const n=await ae(e);if(n)return{tier:6,value:n,confidence:.8,strategy:"ai-cache"}}try{const n=await Se(t.label,{profile:this.profile,options:t.options});if(n)return await pe(e,n),{tier:7,value:n,confidence:.7,strategy:"groq-ai"}}catch(n){console.warn("Groq failed, trying fallback",n)}try{const n=await ke(t.label,{profile:this.profile,options:t.options});if(n)return{tier:8,value:n,confidence:.6,strategy:"gemini-nano"}}catch{}return{tier:9,value:null,confidence:0,strategy:"failed",action:"manual"}}getValueByPath(t){return t.split(".").reduce((e,o)=>e?e[o]:null,this.profile)}async resolveQuick(t){const e=t.label.toLowerCase().trim();if(ie.some(n=>n.test(e)))return{tier:0,value:null,confidence:1,strategy:"security-block",action:"skip",reason:"sensitive-data"};if(le.some(n=>n.test(e)))return{tier:0,value:null,confidence:1,strategy:"user-consent",action:"ask",reason:"requires-consent"};if(C[e]){const n=C[e];let a=this.getValueByPath(n.path);if(!a&&n.inferFrom&&(a=this.getValueByPath(n.inferFrom)),a)return{tier:2,value:a,confidence:1,strategy:"canonical-exact",transform:n.transform}}for(const[n,a]of Object.entries(C)){if(Math.abs(e.length-n.length)>3)continue;if(G(e,n)<=2){let i=this.getValueByPath(a.path);if(!i&&a.inferFrom&&(i=this.getValueByPath(a.inferFrom)),i)return{tier:3,value:i,confidence:.9,strategy:`fuzzy-canonical(${n})`,transform:a.transform}}}for(const n of oe)if(n.regex.test(e)){const a=this.getValueByPath(n.path);if(a)return{tier:4,value:a,confidence:.85,strategy:"regex-pattern",transform:n.transform}}const o=ne(t.label);if(o)return{tier:5,value:se(o,this.profile,this.jobContext),confidence:.8,strategy:"template-match"};if(e.length>2){const n=await ae(e);if(n)return{tier:6,value:n,confidence:.8,strategy:"ai-cache"}}return{tier:9,value:null,confidence:0,strategy:"needs-ai",action:"manual",needsAi:!0}}getProfile(){return this.profile}}class O{matches(t){return this.hostPatterns.some(e=>e.test(t))}async waitUntilReady(){await new Promise(t=>setTimeout(t,500))}async verify(t,e){const o=t.element;return o.value===e||o.value.includes(e)}async refreshElement(t){return t.id?document.getElementById(t.id):t.name?document.querySelector(`[name="${t.name}"]`):null}getLabel(t){var r,i,c;const e=t.getAttribute("aria-label");if(e)return e.trim();const o=t.id;if(o){const l=document.querySelector(`label[for="${o}"]`);if(l)return((r=l.textContent)==null?void 0:r.trim())||""}const n=t.closest("label");if(n)return((i=n.textContent)==null?void 0:i.trim())||"";const a=t.previousElementSibling;return a&&a.tagName==="LABEL"?((c=a.textContent)==null?void 0:c.trim())||"":t.getAttribute("placeholder")||t.getAttribute("name")||""}getOptions(t){if(t.tagName==="SELECT")return Array.from(t.options).map(o=>o.text);const e=t.getAttribute("name");if(e){const o=document.querySelectorAll(`input[name="${e}"]`);return Array.from(o).map(n=>{var r;const a=document.querySelector(`label[for="${n.id}"]`);return((r=a==null?void 0:a.textContent)==null?void 0:r.trim())||n.value})}return[]}async typeValue(t,e){t.focus(),t.value=e,t.dispatchEvent(new Event("input",{bubbles:!0})),t.dispatchEvent(new Event("change",{bubbles:!0})),t.blur()}async selectOption(t,e){const n=Array.from(t.options).find(a=>a.text.toLowerCase().includes(e.toLowerCase())||a.value.toLowerCase().includes(e.toLowerCase()));return n?(t.value=n.value,t.dispatchEvent(new Event("change",{bubbles:!0})),!0):!1}async clickOption(t,e){var n;const o=document.querySelectorAll(`input[name="${t}"]`);for(const a of o){const r=document.querySelector(`label[for="${a.id}"]`);if((((n=r==null?void 0:r.textContent)==null?void 0:n.trim())||a.value).toLowerCase().includes(e.toLowerCase()))return a.click(),!0}return!1}}class ve extends O{constructor(){super(...arguments);b(this,"name","lever");b(this,"hostPatterns",[/jobs\.lever\.co/i,/lever\.co\/.*\/apply/i])}async getFields(){var p,m;const e=[],o=document.querySelectorAll('.application-form input:not([type="hidden"]):not([type="radio"]):not([type="checkbox"]):not([type="file"]), .application-form textarea');for(const d of o){if(this.isHidden(d))continue;const y=this.getLeverLabel(d);e.push({label:y,name:d.name,id:d.id,type:d.tagName==="TEXTAREA"?"textarea":d.type||"text",element:d})}const n=document.querySelectorAll(".application-form select");for(const d of n)e.push({label:this.getLeverLabel(d),name:d.name,id:d.id,type:"select",options:this.getOptions(d),element:d});const a=document.querySelectorAll('.application-form input[type="radio"]'),r=new Set;for(const d of a)if(d.name&&!r.has(d.name)){r.add(d.name);const y=d.closest(".application-question");let g="";if(y){const x=y.querySelector(".application-label");x&&(g=((p=x.textContent)==null?void 0:p.trim())||"")}g||(g=this.getLeverLabel(d)),e.push({label:g,name:d.name,type:"radio",options:this.getOptions(d),element:d})}const i=document.querySelectorAll('.application-form input[type="checkbox"]');for(const d of i)e.push({label:this.getLeverLabel(d),name:d.name,id:d.id,type:"checkbox",element:d});const c=[".application-form .application-dropdown",'.application-form [data-qa="dropdown"]','.application-form [role="listbox"]','.application-form [role="combobox"]',".application-form .lever-dropdown",".application-form .select-dropdown",".application-form .custom-select",'.application-form [class*="dropdown"]','.application-form [class*="select"]'],l=document.querySelectorAll(c.join(", ")),h=document.querySelectorAll(".application-form div"),u=[];for(const d of h){const y=((m=d.textContent)==null?void 0:m.trim())||"";(y==="Select..."||y==="Select"||y.startsWith("Select..."))&&(d.closest('[role="listbox"], [role="combobox"], .application-dropdown')||u.push(d))}const f=new Set([...l,...u]);console.log(`[Lever] Found ${f.size} potential custom dropdowns`);for(const d of f){const y=this.getLeverLabel(d);if(!y)continue;const g=d.querySelectorAll('[data-qa="dropdown-option"], .dropdown-option, li, [role="option"]'),x=Array.from(g).map(v=>{var E;return((E=v.textContent)==null?void 0:E.trim())||""}).filter(v=>v&&v!=="Select...");e.push({label:y,name:d.getAttribute("data-name")||d.id||"",id:d.id,type:"lever-dropdown",options:x.length?x:void 0,element:d}),console.log(`[Lever] Detected custom dropdown: "${y}"`)}return console.log(`[Lever] Found ${e.length} fields total`),e}async fill(e,o){const n=e.element;try{switch(e.type){case"text":case"email":case"tel":case"url":case"textarea":return await this.typeValue(n,o),!0;case"select":return await this.selectOption(n,o);case"radio":return await this.clickLeverRadio(e.name,o);case"checkbox":const a=n,r=this.getLeverLabel(a).toLowerCase(),i=o.toLowerCase();return r.includes(i)||i.includes(r)||i==="yes"||i==="true"?(a.checked||a.click(),!0):i==="no"||i==="false"?(a.checked&&a.click(),!0):!1;case"lever-dropdown":return await this.clickLeverDropdown(n,o);default:return console.warn(`[Lever] Unknown field type: ${e.type}`),!1}}catch(a){return console.error(`[Lever] Fill failed for ${e.label}`,a),!1}}isHidden(e){return e.offsetParent===null}getLeverLabel(e){var n;const o=e.closest(".application-field")||e.closest(".application-question");if(o){const a=o.querySelector(".application-label");if(a)return((n=a.textContent)==null?void 0:n.trim())||""}return this.getLabel(e)}async clickLeverRadio(e,o){var a,r;const n=document.querySelectorAll(`input[name="${e}"]`);for(const i of n){const c=i.closest("label");let l=((a=c==null?void 0:c.textContent)==null?void 0:a.trim())||"";if(!l&&i.id){const h=document.querySelector(`label[for="${i.id}"]`);h&&(l=((r=h.textContent)==null?void 0:r.trim())||"")}if(l||(l=i.value),l.toLowerCase().includes(o.toLowerCase())||o.toLowerCase().includes(l.toLowerCase()))return i.click(),i.dispatchEvent(new Event("change",{bubbles:!0})),!0}return!1}async clickLeverDropdown(e,o){var n,a;try{console.log("[Lever] Clicking custom dropdown to open..."),e.click(),await new Promise(h=>setTimeout(h,300));const r=e.closest(".application-question")||document.body,i=['[data-qa="dropdown-option"]',".dropdown-option",".application-dropdown-option",".lever-dropdown-option",'li[role="option"]',".select-option"];let c=r.querySelectorAll(i.join(", "));c.length===0&&(c=document.querySelectorAll(i.join(", "))),console.log(`[Lever] Found ${c.length} dropdown options`);const l=o.toLowerCase();for(const h of c){const u=((n=h.textContent)==null?void 0:n.trim().toLowerCase())||"";if(u===l||u.includes(l)||l.includes(u))return console.log(`[Lever] Clicking option: "${(a=h.textContent)==null?void 0:a.trim()}"`),h.click(),!0}return console.warn(`[Lever] No matching option found for: "${o}"`),document.body.click(),!1}catch(r){return console.error("[Lever] Custom dropdown fill failed:",r),!1}}}class Ee extends O{constructor(){super(...arguments);b(this,"name","greenhouse");b(this,"hostPatterns",[/boards\.greenhouse\.io/i,/greenhouse\.io/i])}async getFields(){var r,i;const e=[],o=document.querySelectorAll('#application input:not([type="hidden"]):not([type="submit"]):not([type="file"]), #application textarea');for(const c of o)c.type==="hidden"||c.disabled||e.push({label:this.getLabel(c),name:c.name,id:c.id,type:c.type||"text",element:c});const n=document.querySelectorAll("#application select");for(const c of n)e.push({label:this.getLabel(c),name:c.name,id:c.id,type:"select",options:this.getOptions(c),element:c});const a=document.querySelectorAll(".field");for(const c of a){const l=((i=(r=c.querySelector("label"))==null?void 0:r.textContent)==null?void 0:i.trim())||"",h=c.querySelector("input, select, textarea");h&&l&&!e.some(u=>u.element===h)&&e.push({label:l,name:h.getAttribute("name")||"",id:h.id,type:h.tagName.toLowerCase()==="select"?"select":h.type||"text",options:h.tagName.toLowerCase()==="select"?this.getOptions(h):void 0,element:h})}return console.log(`[Greenhouse] Found ${e.length} fields`),e}async fill(e,o){const n=e.element;try{switch(e.type){case"text":case"email":case"tel":case"url":case"textarea":return await this.typeValue(n,o),!0;case"select":return await this.selectOption(n,o);case"radio":return await this.clickOption(e.name,o);case"checkbox":const a=n;return/yes|true|agree/i.test(o)!==a.checked&&a.click(),!0;default:return await this.typeValue(n,o),!0}}catch(a){return console.error(`[Greenhouse] Fill failed for ${e.label}`,a),!1}}}class Ae extends O{constructor(){super(...arguments);b(this,"name","workday");b(this,"hostPatterns",[/\.myworkdayjobs\.com/i,/workday\.com/i,/myworkday\.com/i])}async waitUntilReady(){await new Promise(e=>setTimeout(e,1500)),await this.waitForElement('[data-automation-id="jobPostingPage"]',5e3)}async waitForElement(e,o){const n=Date.now();for(;Date.now()-n<o;){const a=document.querySelector(e);if(a)return a;await new Promise(r=>setTimeout(r,200))}return null}async getFields(){var a;const e=[],o=document.querySelectorAll("[data-automation-id]");for(const r of o){const i=r.getAttribute("data-automation-id")||"",c=r.querySelector("input, select, textarea");if(!c)continue;const l=r.querySelector('[data-automation-id*="label"], label');let h=((a=l==null?void 0:l.textContent)==null?void 0:a.trim())||this.getLabel(c);h=h.replace(/\*/g,"").replace(/\s+/g," ").trim();let u="text";c.tagName==="SELECT"?u="select":c.type&&(u=c.type),r.querySelector('[data-automation-id*="dropdown"]')!==null&&(u="workday-dropdown"),e.push({label:h,name:c.getAttribute("name")||i,id:c.id||i,type:u,options:u==="select"?this.getOptions(c):void 0,element:c})}const n=document.querySelectorAll('input[data-automation-id]:not([type="hidden"]), textarea[data-automation-id]');for(const r of n)e.some(i=>i.element===r)||e.push({label:this.getLabel(r),name:r.getAttribute("name")||r.getAttribute("data-automation-id")||"",id:r.id,type:r.type||"text",element:r});return console.log(`[Workday] Found ${e.length} fields`),e}async fill(e,o){const n=e.element;try{if(e.type==="workday-dropdown")return await this.fillWorkdayDropdown(n,o);switch(e.type){case"text":case"email":case"tel":case"url":case"textarea":return await this.fillReactInput(n,o),!0;case"select":return await this.selectOption(n,o);case"radio":return await this.clickOption(e.name,o);case"checkbox":const a=n;return/yes|true|agree/i.test(o)!==a.checked&&a.click(),!0;default:return await this.fillReactInput(n,o),!0}}catch(a){return console.error(`[Workday] Fill failed for ${e.label}`,a),!1}}async fillReactInput(e,o){var a,r;e.focus(),await new Promise(i=>setTimeout(i,50));const n=((a=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"value"))==null?void 0:a.set)||((r=Object.getOwnPropertyDescriptor(window.HTMLTextAreaElement.prototype,"value"))==null?void 0:r.set);n?n.call(e,o):e.value=o,e.dispatchEvent(new Event("input",{bubbles:!0,composed:!0})),await new Promise(i=>setTimeout(i,100)),e.dispatchEvent(new Event("change",{bubbles:!0,composed:!0})),await new Promise(i=>setTimeout(i,100)),e.blur()}async refreshElement(e){if(e.id){const o=document.getElementById(e.id);if(o)return o}if(e.name){const o=document.querySelector(`[data-automation-id="${e.name}"]`);if(o)return o;const n=document.querySelector(`[data-automation-id="${e.name}"]`);if(n){const r=n.querySelector("input, select, textarea");if(r)return r}const a=document.querySelector(`[name="${e.name}"]`);if(a)return a}return null}async fillWorkdayDropdown(e,o){var r,i,c;const n=((r=e.closest('[data-automation-id*="dropdown"]'))==null?void 0:r.querySelector("button"))||((i=e.closest(".css-dropdown"))==null?void 0:i.querySelector("button"));if(!n)return console.warn("[Workday] Can't find dropdown trigger"),!1;n.click(),await new Promise(l=>setTimeout(l,300));const a=document.querySelectorAll('[role="option"], [data-automation-id*="option"]');for(const l of a)if((((c=l.textContent)==null?void 0:c.trim())||"").toLowerCase().includes(o.toLowerCase()))return l.click(),!0;return document.body.click(),!1}}class Te extends O{constructor(){super(...arguments);b(this,"name","linkedin");b(this,"hostPatterns",[/linkedin\.com/i])}async waitUntilReady(){await new Promise(o=>setTimeout(o,1e3)),document.querySelector(".jobs-easy-apply-modal, [data-test-modal]")||console.warn("[LinkedIn] Easy Apply modal not found")}async getFields(){const e=[],o=document.querySelector(".jobs-easy-apply-modal, [data-test-modal]")||document,n=o.querySelectorAll('input[type="text"], input[type="email"], input[type="tel"], input[type="url"], textarea');for(const l of n)l.type==="hidden"||l.disabled||e.push({label:this.getLinkedInLabel(l),name:l.name,id:l.id,type:l.type||"text",element:l});const a=o.querySelectorAll("select");for(const l of a)e.push({label:this.getLinkedInLabel(l),name:l.name,id:l.id,type:"select",options:this.getOptions(l),element:l});o.querySelectorAll("[data-test-text-selectable-option]");const r=new Set,i=o.querySelectorAll('input[type="radio"]');for(const l of i)if(l.name&&!r.has(l.name)){r.add(l.name);const h=l.closest(".fb-dash-form-element")||l.parentElement;e.push({label:this.getLinkedInLabel(h||l),name:l.name,type:"radio",options:this.getOptions(l),element:l})}const c=o.querySelectorAll('input[type="checkbox"]');for(const l of c)e.push({label:this.getLinkedInLabel(l),name:l.name,id:l.id,type:"checkbox",element:l});return console.log(`[LinkedIn] Found ${e.length} fields`),e}getLinkedInLabel(e){var a;const o=e.closest(".fb-dash-form-element, .jobs-easy-apply-form-section__grouping");if(o){const r=o.querySelector("label, .fb-dash-form-element__label, .t-14");if(r)return((a=r.textContent)==null?void 0:a.trim())||""}const n=e.getAttribute("aria-label");return n?n.trim():this.getLabel(e)}async fill(e,o){const n=e.element;try{switch(e.type){case"text":case"email":case"tel":case"url":case"textarea":return await this.fillLinkedInInput(n,o),!0;case"select":return await this.selectOption(n,o);case"radio":return await this.clickOption(e.name,o);case"checkbox":const a=n;return/yes|true|agree/i.test(o)!==a.checked&&a.click(),!0;default:return await this.fillLinkedInInput(n,o),!0}}catch(a){return console.error(`[LinkedIn] Fill failed for ${e.label}`,a),!1}}async fillLinkedInInput(e,o){var a;e.focus(),e.value="",e.dispatchEvent(new Event("input",{bubbles:!0}));const n=(a=Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,"value"))==null?void 0:a.set;n?n.call(e,o):e.value=o,e.dispatchEvent(new Event("input",{bubbles:!0})),e.dispatchEvent(new Event("change",{bubbles:!0})),await new Promise(r=>setTimeout(r,100)),e.blur()}}class he extends O{constructor(){super(...arguments);b(this,"name","generic");b(this,"hostPatterns",[/.*/])}async getFields(){const e=[],o=document.querySelectorAll('form[id*="apply"], form[id*="application"], form[class*="apply"], form[class*="application"], form, .application-form, #application'),n=o.length>0?o[0]:document,a=n.querySelectorAll('input[type="text"], input[type="email"], input[type="tel"], input[type="url"], input[type="number"], textarea');for(const u of a)this.shouldSkip(u)||e.push({label:this.getLabel(u),name:u.name,id:u.id,type:u.type||"text",element:u});const r=n.querySelectorAll("select");for(const u of r)this.shouldSkip(u)||e.push({label:this.getLabel(u),name:u.name,id:u.id,type:"select",options:this.getOptions(u),element:u});const i=new Set,c=n.querySelectorAll('input[type="radio"]');for(const u of c)u.name&&!i.has(u.name)&&(i.add(u.name),e.push({label:this.getRadioGroupLabel(u),name:u.name,type:"radio",options:this.getOptions(u),element:u}));const l=n.querySelectorAll('input[type="checkbox"]');for(const u of l)this.shouldSkip(u)||e.push({label:this.getLabel(u),name:u.name,id:u.id,type:"checkbox",element:u});const h=n.querySelectorAll('input[type="file"]');for(const u of h)e.push({label:this.getLabel(u)||"Resume/CV Upload",name:u.name,id:u.id,type:"file",element:u});return console.log(`[Generic] Found ${e.length} fields`),e}shouldSkip(e){var r,i;if(e.type==="hidden"||e.disabled)return!0;const o=window.getComputedStyle(e);if(o.display==="none"||o.visibility==="hidden")return!0;const n=((r=e.name)==null?void 0:r.toLowerCase())||"",a=((i=e.id)==null?void 0:i.toLowerCase())||"";return!!(n.includes("captcha")||a.includes("captcha")||n.includes("search")||a.includes("search"))}getRadioGroupLabel(e){var a,r;const o=e.closest("fieldset");if(o){const i=o.querySelector("legend");if(i)return((a=i.textContent)==null?void 0:a.trim())||""}const n=e.closest(".form-group, .field, .question");if(n){const i=n.querySelector("label, .label, h3, h4");if(i)return((r=i.textContent)==null?void 0:r.trim())||""}return this.getLabel(e)}async fill(e,o){const n=e.element;try{switch(e.type){case"text":case"email":case"tel":case"url":case"number":case"textarea":return await this.typeValue(n,o),!0;case"select":return await this.selectOption(n,o);case"radio":return await this.clickOption(e.name,o);case"checkbox":const a=n;return/yes|true|agree|accept/i.test(o)!==a.checked&&a.click(),!0;case"file":return console.log(`[Generic] File input detected: ${e.label}`),!1;default:return await this.typeValue(n,o),!0}}catch(a){return console.error(`[Generic] Fill failed for ${e.label}`,a),!1}}}const $e=[new Ae,new Te,new ve,new Ee,new he];function Ce(s=window.location.href){for(const t of $e)if(t.matches(s))return console.log(`[Registry] Using adapter: ${t.name}`),t;return new he}const ce="llama-3.1-8b-instant",_=3,Ie=2e3;async function Fe(s,t){var p,m,d,y,g,x,v,E,I,F,R,N,q,J,V,H,W,K,Q,X,Z,ee,te;const{settings:e}=await chrome.storage.local.get("settings");let o=(e==null?void 0:e.groqApiKey)||(e==null?void 0:e.groqApiKeys),n=(e==null?void 0:e.groqModel)||ce;if(!o){console.log("[Groq Batch] No key in local storage, checking Firebase...");try{const{auth:w}=await chrome.storage.local.get("auth");if(w!=null&&w.uid){const L=await fetch("https://firestore.googleapis.com/v1/projects/ai-resume-f9b01/databases/(default)/documents/adminSettings/extension");if(L.ok){const $=(await L.json()).fields||{};o=((p=$.groqApiKeys)==null?void 0:p.stringValue)||((m=$.groqApiKey)==null?void 0:m.stringValue),n=((d=$.groqModel)==null?void 0:d.stringValue)||n,o&&(console.log("[Groq Batch] ✅ Got API key from Firebase admin settings"),await chrome.storage.local.set({settings:{...e,groqApiKey:o,groqModel:n}}))}}}catch(w){console.warn("[Groq Batch] Firebase fallback failed:",w)}}if(o&&o.includes(`
`)&&(o=o.split(`
`)[0].trim()),console.log("[Groq Batch] Settings loaded:",{hasSettings:!!e,hasApiKey:!!o,apiKeyLength:(o==null?void 0:o.length)||0,model:n}),!o)throw console.warn("[Groq Batch] No API key configured"),new Error("Groq API Key missing. Open extension popup to sync settings, or add key in admin.");if(s.length===0)return[];console.log(`[Groq Batch] Processing ${s.length} questions in one call`);const a=((g=(y=t.skills)==null?void 0:y.technical)==null?void 0:g.join(", "))||"Python, SQL, JavaScript",r=((v=(x=t.experience)==null?void 0:x.history)==null?void 0:v[0])||{},i=((I=(E=t.education)==null?void 0:E.history)==null?void 0:I[0])||{},c=`
CANDIDATE SUMMARY:
- Name: ${((F=t.identity)==null?void 0:F.fullName)||"Candidate"}
- Current Role: ${r.title||((R=t.experience)==null?void 0:R.currentTitle)||"Software Engineer"}
- Current Company: ${r.company||((N=t.experience)==null?void 0:N.currentCompany)||"Tech Company"}
- Technical Skills: ${a}
- Education: ${i.degree||""} from ${i.school||"University"}
- Years of Experience: ${((J=(q=t.experience)==null?void 0:q.history)==null?void 0:J.length)||3}+ years
- Location: ${((H=(V=t.identity)==null?void 0:V.location)==null?void 0:H.city)||""}, ${((K=(W=t.identity)==null?void 0:W.location)==null?void 0:K.state)||""}
`,l=s.map((w,k)=>{var $;const S=w.question.toLowerCase();let L="";S.includes("rate")&&(S.includes("1")||S.includes("5")||S.includes("scale"))?L="(RESPOND WITH A NUMBER 1-5 ONLY)":S.includes("describe")||S.includes("explain")||S.includes("tell us")||S.includes("how have you")?L="(WRITE 2-3 SENTENCES ABOUT RELEVANT EXPERIENCE)":(S.includes("what technical tools")||S.includes("comfortable with"))&&(L="(LIST SPECIFIC TOOLS/TECHNOLOGIES)");const A=($=w.options)!=null&&$.length?`
   Options: ${JSON.stringify(w.options)}`:"";return`${k+1}. [ID:${w.id}] ${w.question} ${L}${A}`}).join(`

`),h=`You are filling out a job application form. Read each question carefully and provide an appropriate answer.

${c}

CRITICAL RULES - FOLLOW EXACTLY:

1. READ THE QUESTION CAREFULLY before answering
   - "What technical tools" = Answer with TOOLS like "Python, Apache Airflow, dbt, SQL, Kubernetes"
   - "Rate your experience 1-5" = Answer with JUST A NUMBER like "4" or "5"
   - "Describe how you" = Answer with 2-3 sentences about relevant experience

2. NEVER put education info (degree, university) in a tools/experience question
3. NEVER put dates in a description question
4. For rating questions (1-5 scale), ONLY respond with a single number (e.g., "4")
5. For description questions, write complete sentences about relevant experience

OUTPUT FORMAT - EXACTLY LIKE THIS:
[ID:field_0] Python, Apache Airflow, dbt, SQL, Kubernetes
[ID:field_1] 4
[ID:field_2] I have extensive experience using data quality tools like Great Expectations and dbt tests to implement automated data validation pipelines. These tools helped catch data anomalies early and maintain data integrity.`,u=`Answer each question based on the candidate's profile. Match the answer type to the question type.

${l}

Remember:
- "tools" questions → list technologies
- "rate 1-5" questions → single number
- "describe" questions → 2-3 sentences`;let f=null;for(let w=1;w<=_;w++)try{const k=await fetch("https://api.groq.com/openai/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify({model:(e==null?void 0:e.groqModel)||ce,messages:[{role:"system",content:h},{role:"user",content:u}],temperature:.1,max_tokens:1500})});if(k.status===429){console.warn(`[Groq Batch] Rate limited (attempt ${w}/${_})`),await new Promise(A=>setTimeout(A,Ie*w)),f=new Error("Rate limited");continue}if(!k.ok){const A=await k.json().catch(()=>({}));throw new Error(`Groq API Error ${k.status}: ${((Q=A==null?void 0:A.error)==null?void 0:Q.message)||k.statusText}`)}const S=await k.json();if(S.error)throw new Error(`Groq Error: ${S.error.message}`);const L=(te=(ee=(Z=(X=S.choices)==null?void 0:X[0])==null?void 0:Z.message)==null?void 0:ee.content)==null?void 0:te.trim();if(!L)throw new Error("Empty response from Groq");return console.log("[Groq Batch] Raw response:",L.substring(0,200)),Re(L,s)}catch(k){f=k,console.error(`[Groq Batch] Attempt ${w} failed:`,k),w<_&&await new Promise(S=>setTimeout(S,1e3))}throw f||new Error("Groq batch failed after max retries")}function Re(s,t){const e=[],o=s.split(`
`).filter(r=>r.trim()),n=new Set(t.map(r=>r.id));for(const r of o){const i=r.match(/\[ID:([^\]]+)\]\s*(.+)/);if(i){const c=i[1].trim(),l=i[2].trim();n.has(c)&&(e.push({id:c,answer:l}),console.log(`[Groq Batch] Parsed: ${c} → ${l.substring(0,30)}`))}}const a=new Set(e.map(r=>r.id));for(const r of t)a.has(r.id)||(console.warn(`[Groq Batch] No answer for: ${r.id}`),e.push({id:r.id,answer:"N/A"}));return e}const Ne=500;class qe{constructor(t,e,o){b(this,"matcher");b(this,"onProgress");this.profile=t,this.matcher=new Le(t,e),this.onProgress=o}async fillForm(){var l,h,u;const t=Date.now(),e=[],o=Ce();console.log(`[Filler] Using adapter: ${o.name}`),await o.waitUntilReady();const n=await o.getFields();console.log(`[Filler] Found ${n.length} fields`),console.log("[Filler] Pass 1: Quick matching all fields...");const a=new Map,r=[];for(let f=0;f<n.length;f++){const p=n[f];(l=this.onProgress)==null||l.call(this,f+1,n.length,p,"scanning");try{const m=await this.matcher.resolveQuick(p);a.set(f,m),m.needsAi&&r.push({index:f,field:p})}catch(m){console.error(`[Filler] Quick match failed for ${p.label}`,m),a.set(f,{tier:9,value:null,confidence:0,strategy:"error",needsAi:!0}),r.push({index:f,field:p})}}console.log(`[Filler] Pass 1 complete: ${n.length-r.length} matched, ${r.length} need AI`);const i=new Map;if(r.length>0){console.log(`[Filler] Pass 2: Sending ${r.length} questions to LLM Box...`),(h=this.onProgress)==null||h.call(this,0,r.length,r[0].field,"ai-processing");try{const f=r.map(({index:m,field:d})=>({id:`field_${m}`,question:d.label,options:d.options})),p=await Fe(f,this.matcher.getProfile());for(const m of p){const d=m.id.match(/field_(\d+)/);if(d){const y=parseInt(d[1]);i.set(y,m.answer);const g=n[y];g&&m.answer!=="N/A"&&await pe(g.label.toLowerCase().trim(),m.answer)}}console.log(`[Filler] Pass 2 complete: Got ${i.size} answers from LLM Box`)}catch(f){console.error("[Filler] LLM Box failed:",f)}}console.log("[Filler] Pass 3: Applying values...");for(let f=0;f<n.length;f++){const p=n[f];if((u=this.onProgress)==null||u.call(this,f+1,n.length,p,"filling"),!p.element.isConnected){console.log(`[Filler] Field ${p.label} detached. Refreshing...`),await this.delay(1e3);const m=await o.refreshElement(p);if(m)p.element=m;else{e.push({field:p,status:"failed",reason:"element-detached"});continue}}this.highlightField(p.element,"active");try{let m=a.get(f);if(m.needsAi&&i.has(f)){const y=i.get(f);y&&y!=="N/A"&&(m={tier:7,value:y,confidence:.7,strategy:"llm-box-batch"})}const d=await this.handleMatch(p,m,o);e.push(d),this.highlightField(p.element,d.status)}catch(m){console.error(`[Filler] Error on field: ${p.label}`,m),e.push({field:p,status:"failed",reason:"exception"}),this.highlightField(p.element,"failed")}await this.delay(Ne)}const c={total:n.length,filled:e.filter(f=>f.status==="filled").length,skipped:e.filter(f=>f.status==="skipped").length,failed:e.filter(f=>f.status==="failed").length,needsUser:e.filter(f=>f.status==="needs-user").length,timeMs:Date.now()-t,results:e};return console.log(`[Filler] Complete: ${c.filled}/${c.total} in ${c.timeMs}ms`),c}async handleMatch(t,e,o){if(e.action==="skip")return{field:t,status:"skipped",reason:e.reason};if(e.action==="ask")return{field:t,status:"needs-user",reason:e.reason};if(e.action==="manual"||e.value===null)return{field:t,status:"failed",reason:"no-match",tier:e.tier};let n=e.value;return e.transform&&D[e.transform]&&(n=D[e.transform](t.options||[],e.value,this.profile)),n=String(n),await o.fill(t,n)?{field:t,status:"filled",tier:e.tier,strategy:e.strategy,value:n}:{field:t,status:"failed",tier:e.tier,strategy:e.strategy,reason:"fill-failed"}}highlightField(t,e){switch(t.classList.remove("jf-field-active","jf-field-success","jf-field-failed","jf-field-skipped","jf-field-warning"),e){case"active":t.classList.add("jf-field-active");break;case"filled":t.classList.add("jf-field-success");break;case"failed":t.classList.add("jf-field-failed");break;case"skipped":t.classList.add("jf-field-skipped");break;case"needs-user":t.classList.add("jf-field-warning");break}}delay(t){return new Promise(e=>setTimeout(e,t))}}class Pe{constructor(){b(this,"container",null);b(this,"progressBar",null);b(this,"statusText",null);b(this,"countText",null)}injectStyles(){if(document.getElementById("jf-overlay-styles"))return;const t=document.createElement("style");t.id="jf-overlay-styles",t.textContent=`
      /* Progress Widget */
      .jf-progress-widget {
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 220px;
        padding: 14px 18px;
        background: rgba(255, 255, 255, 0.97);
        backdrop-filter: blur(10px);
        border-radius: 14px;
        box-shadow: 0 4px 24px rgba(0, 0, 0, 0.12);
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        z-index: 2147483647;
        transition: all 0.3s ease;
      }

      .jf-progress-widget.jf-minimized {
        width: auto;
        padding: 10px 14px;
      }

      .jf-progress-header {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 10px;
      }

      .jf-progress-icon {
        font-size: 16px;
        animation: jf-spin 1s linear infinite;
      }

      .jf-progress-title {
        font-size: 13px;
        font-weight: 600;
        color: #1a1a1a;
      }

      .jf-progress-count {
        font-size: 12px;
        color: #666;
        margin-left: auto;
      }

      .jf-progress-bar-container {
        height: 4px;
        background: #e8e8e8;
        border-radius: 2px;
        overflow: hidden;
      }

      .jf-progress-bar-fill {
        height: 100%;
        background: linear-gradient(90deg, #4CAF50, #8BC34A);
        border-radius: 2px;
        transition: width 0.3s ease;
        width: 0%;
      }

      .jf-progress-status {
        font-size: 11px;
        color: #888;
        margin-top: 8px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      /* Summary */
      .jf-summary {
        margin-top: 12px;
        padding-top: 12px;
        border-top: 1px solid #eee;
      }

      .jf-summary-stats {
        display: flex;
        gap: 12px;
        font-size: 11px;
      }

      .jf-stat {
        display: flex;
        align-items: center;
        gap: 4px;
      }

      .jf-stat-icon {
        font-size: 12px;
      }

      /* Field Highlights */
      .jf-field-active {
        outline: 2px solid #2196F3 !important;
        outline-offset: 2px;
        animation: jf-pulse 1s ease-in-out infinite;
      }

      .jf-field-success {
        outline: 2px solid #4CAF50 !important;
        outline-offset: 2px;
      }

      .jf-field-failed {
        outline: 2px solid #f44336 !important;
        outline-offset: 2px;
      }

      .jf-field-skipped {
        outline: 2px solid #9E9E9E !important;
        outline-offset: 2px;
      }

      .jf-field-warning {
        outline: 2px solid #FF9800 !important;
        outline-offset: 2px;
      }

      @keyframes jf-pulse {
        0%, 100% { outline-color: #2196F3; }
        50% { outline-color: #64B5F6; }
      }

      @keyframes jf-spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
      }
    `,document.head.appendChild(t)}show(){this.injectStyles(),!this.container&&(this.container=document.createElement("div"),this.container.className="jf-progress-widget",this.container.innerHTML=`
      <div class="jf-progress-header">
        <span class="jf-progress-icon">⚡</span>
        <span class="jf-progress-title">Filling...</span>
        <span class="jf-progress-count" id="jf-count">0/0</span>
      </div>
      <div class="jf-progress-bar-container">
        <div class="jf-progress-bar-fill" id="jf-bar"></div>
      </div>
      <div class="jf-progress-status" id="jf-status">Starting...</div>
    `,document.body.appendChild(this.container),this.progressBar=document.getElementById("jf-bar"),this.statusText=document.getElementById("jf-status"),this.countText=document.getElementById("jf-count"))}update(t,e,o,n){var r;this.container||this.show();const a=Math.round(t/e*100);if(this.progressBar&&(this.progressBar.style.width=`${a}%`),this.countText&&(this.countText.textContent=`${t}/${e}`),this.statusText){const i=((r=o.label)==null?void 0:r.slice(0,30))||"Field";this.statusText.textContent=`${n}: ${i}...`}}showSummary(t){if(!this.container)return;const e=this.container.querySelector(".jf-progress-header");e&&(e.innerHTML=`
        <span class="jf-progress-icon" style="animation: none">✅</span>
        <span class="jf-progress-title">Complete!</span>
        <span class="jf-progress-count">${t.timeMs}ms</span>
      `),this.progressBar&&(this.progressBar.style.width="100%"),this.statusText&&(this.statusText.innerHTML=`
        <div class="jf-summary-stats">
          <span class="jf-stat"><span class="jf-stat-icon">✅</span> ${t.filled}</span>
          <span class="jf-stat"><span class="jf-stat-icon">⏭️</span> ${t.skipped}</span>
          <span class="jf-stat"><span class="jf-stat-icon">❌</span> ${t.failed}</span>
          ${t.needsUser>0?`<span class="jf-stat"><span class="jf-stat-icon">⚠️</span> ${t.needsUser}</span>`:""}
        </div>
      `),setTimeout(()=>this.hide(),5e3)}hide(){this.container&&(this.container.remove(),this.container=null),document.querySelectorAll(".jf-field-active, .jf-field-success, .jf-field-failed, .jf-field-skipped, .jf-field-warning").forEach(t=>{t.classList.remove("jf-field-active","jf-field-success","jf-field-failed","jf-field-skipped","jf-field-warning")})}}const z=new Pe;function je(s){const t=new Uint8Array(s);let e="";for(let o=0;o<t.byteLength;o++)e+=String.fromCharCode(t[o]);return btoa(e)}function Oe(s){const t=atob(s),e=new Uint8Array(t.length);for(let o=0;o<t.length;o++)e[o]=t.charCodeAt(o);return e.buffer}async function ze(s,t,e){const o=await t.arrayBuffer(),n=je(o),a={id:s,data:n,name:e,type:t.type,size:t.size,updatedAt:Date.now()},r=`file_${s}`;await chrome.storage.local.set({[r]:a}),console.log(`[Storage] Stored file: ${s} (${e}, ${t.size} bytes)`)}async function T(s){const t=`file_${s}`,o=(await chrome.storage.local.get([t]))[t];if(!o)return null;const n=Oe(o.data);return{blob:new Blob([n],{type:o.type}),name:o.name,type:o.type,size:o.size,updatedAt:o.updatedAt}}async function Y(s,t,e,o){const n=new Blob([t],{type:o});return ze(s,n,e)}const B="resume",M="resume-docx";function Be(s){const t=(s.accept||"").toLowerCase();return(t.includes(".docx")||t.includes("word")||t.includes("openxmlformats"))&&!t.includes("pdf")&&!t.includes(".pdf")?"docx":(t.includes("pdf")||t.includes(".pdf"))&&!t.includes("doc")&&!t.includes("word")?"pdf":"any"}async function Me(s){try{if(s.files&&s.files.length>0)return console.log(`[Resume] Skipping (already has file): ${s.files[0].name}`),!0;const t=Be(s);console.log(`[Resume] Detected format preference: ${t}`);let e=null;if(t==="docx"?(e=await T(M),e||(console.log("[Resume] No DOCX stored, falling back to PDF"),e=await T(B))):(e=await T(B),!e&&t==="any"&&(console.log("[Resume] No PDF stored, trying DOCX"),e=await T(M))),!e)return console.log("[Resume] No resume stored"),!1;const o=new File([e.blob],e.name,{type:e.type,lastModified:e.updatedAt}),n=new DataTransfer;return n.items.add(o),s.files=n.files,s.dispatchEvent(new Event("change",{bubbles:!0})),s.dispatchEvent(new Event("input",{bubbles:!0})),console.log(`[Resume] Attached: ${e.name} (${e.size} bytes, ${e.type})`),!0}catch(t){return console.error("[Resume] Failed to attach:",t),!1}}async function Ue(s){try{const e=await T(s==="pdf"?B:M);if(!e)return{success:!1,count:0,error:`No ${s.toUpperCase()} resume stored`};console.log(`[Resume] Attaching ${s.toUpperCase()}: ${e.name}`);const o=me();if(o.length===0){const a=document.querySelectorAll('input[type="file"]');if(a.length===0)return{success:!1,count:0,error:"No file inputs found on page"};const r=await ue(a[0],e);return{success:r,count:r?1:0}}let n=0;for(const a of o)await ue(a,e)&&n++;return{success:n>0,count:n}}catch(t){return console.error("[Resume] attachResumeWithFormat failed:",t),{success:!1,count:0,error:String(t)}}}async function ue(s,t){try{if(s.files&&s.files.length>0)return console.log(`[Resume] Skipping input (already has file): ${s.files[0].name}`),!1;const e=new File([t.blob],t.name,{type:t.type,lastModified:t.updatedAt}),o=new DataTransfer;return o.items.add(e),s.files=o.files,s.dispatchEvent(new Event("change",{bubbles:!0})),s.dispatchEvent(new Event("input",{bubbles:!0})),console.log(`[Resume] ✓ Attached to input: ${s.id||s.name||"unnamed"}`),!0}catch(e){return console.error("[Resume] Failed to attach to input:",e),!1}}function me(){const s=document.querySelectorAll('input[type="file"]');console.log(`[Resume] Found ${s.length} file inputs on page`);const t=Array.from(s).filter(e=>{var p,m,d,y,g,x,v,E,I,F,R,N,q;const o=((p=e.accept)==null?void 0:p.toLowerCase())||"",n=((m=e.id)==null?void 0:m.toLowerCase())||"",a=((d=e.name)==null?void 0:d.toLowerCase())||"";(y=e.className)!=null&&y.toLowerCase();const r=((g=e.getAttribute("aria-label"))==null?void 0:g.toLowerCase())||"",i=((v=(x=e.closest("label"))==null?void 0:x.textContent)==null?void 0:v.toLowerCase())||"",c=e.id&&((I=(E=document.querySelector(`label[for="${e.id}"]`))==null?void 0:E.textContent)==null?void 0:I.toLowerCase())||"",l=((R=(F=e.parentElement)==null?void 0:F.textContent)==null?void 0:R.toLowerCase())||"",h=((q=(N=e.closest('[class*="upload"], [class*="resume"], [class*="file"]'))==null?void 0:N.textContent)==null?void 0:q.toLowerCase())||"",u=`${r} ${i} ${c} ${l} ${h} ${n} ${a}`,f=u.includes("resume")||u.includes("cv")||u.includes("curriculum")||n.includes("resume")||a.includes("resume")||a.includes("cv")||o.includes("pdf")||o.includes("doc");return f&&console.log("[Resume] ✓ Found resume input:",{id:e.id,name:e.name,accept:e.accept,visible:e.offsetParent!==null}),f});return console.log(`[Resume] Matched ${t.length} resume inputs`),t}async function _e(){console.log("[Resume] === Starting fillAllResumeInputs ===");const s=await T(B),t=await T(M);if(console.log("[Resume] Storage status:",{hasPdf:!!s,pdfName:s==null?void 0:s.name,hasDocx:!!t,docxName:t==null?void 0:t.name}),!s&&!t)return console.warn("[Resume] No resume files stored - cannot upload"),0;const e=me();if(e.length===0){console.log("[Resume] No resume inputs found on page");const n=document.querySelectorAll('input[type="file"]');console.log("[Resume] All file inputs on page:",n.length),n.forEach((a,r)=>{console.log(`[Resume] Input ${r}:`,{id:a.id,name:a.name,accept:a.accept,visible:a.offsetParent!==null})})}let o=0;for(const n of e)console.log(`[Resume] Attempting to attach to input: ${n.id||n.name||"unnamed"}`),await Me(n)?(o++,console.log("[Resume] ✓ Successfully attached resume!")):console.log("[Resume] ✗ Failed to attach resume");return console.log(`[Resume] === fillAllResumeInputs complete: ${o}/${e.length} filled ===`),o}console.log("[JobFiller Pro V2] Content Script Loaded 🚀");chrome.runtime.onMessage.addListener((s,t,e)=>{switch(console.log("[Listener] Message received:",s.type),s.type){case"PING":e({status:"PONG"});break;case"FILL_FORM":return De().then(e),!0;case"GET_STATUS":return Je().then(e),!0;case"UPLOAD_RESUME":return Ge(s.format).then(e),!0;default:console.log("[Listener] Unknown message type:",s.type)}});window.addEventListener("message",async s=>{const t=s.data;if(!(!t||!t.type))switch(console.log("[Listener] Window message:",t.type),t.type){case"JOBFILLER_AUTH":case"JOBFILLER_SYNC":await Ye(t);break;case"JOBFILLER_PROFILE":await He(t.payload);break;case"JOBFILLER_SESSION":await We(t.payload);break;case"JOBFILLER_SETTINGS":await Ke(t.payload);break;case"JOBFILLER_PING":window.postMessage({type:"JOBFILLER_PONG",installed:!0},"*");break}});async function De(){try{const s=await chrome.storage.local.get(["profile","auth"]);if(!s.profile)return{success:!1,error:"No profile synced. Please sync from dashboard first."};const t=s.profile;z.show();const o=await new qe(t,void 0,(n,a,r,i)=>{z.update(n,a,r,i)}).fillForm();return await _e(),z.showSummary(o),await Ve(o.filled),{success:!0,filled:o.filled}}catch(s){return console.error("[Listener] Fill error:",s),z.hide(),{success:!1,error:String(s)}}}async function Ge(s){try{console.log(`[Listener] Uploading ${s.toUpperCase()} resume to page...`);const t=await Ue(s);return t.success?(console.log(`[Listener] ✓ Uploaded ${s.toUpperCase()} to ${t.count} input(s)`),{success:!0}):(console.warn("[Listener] Upload failed:",t.error),{success:!1,error:t.error})}catch(t){return console.error("[Listener] Upload error:",t),{success:!1,error:String(t)}}}async function Ye(s){try{const{session:t,profile:e,resume:o,settings:n}=s.payload||s;t&&(await chrome.storage.local.set({auth:{uid:t.uid,email:t.email,displayName:t.displayName,photoURL:t.photoURL,token:t.token,expiresAt:t.expiresAt||Date.now()+36e5,syncedAt:Date.now()}}),console.log("[Sync] Auth stored for:",t.email)),e&&(await chrome.storage.local.set({profile:e}),console.log("[Sync] Profile stored")),o&&o.buffer&&(await Y("resume",o.buffer,o.name||"resume.pdf",o.type||"application/pdf"),await chrome.storage.local.set({resumeInfo:{name:o.name,size:o.buffer.byteLength,type:o.type}}),console.log("[Sync] Resume stored:",o.name)),n&&(await chrome.storage.local.set({settings:n}),console.log("[Sync] Settings stored")),window.postMessage({type:"JOBFILLER_SYNC_SUCCESS"},"*")}catch(t){console.error("[Sync] Error:",t),window.postMessage({type:"JOBFILLER_SYNC_ERROR",error:String(t)},"*")}}async function Je(){var t;const s=await chrome.storage.local.get(["auth","profile","resumeInfo","stats"]);return{isAuthenticated:!!((t=s.auth)!=null&&t.uid),hasProfile:!!s.profile,hasResume:!!s.resumeInfo,stats:s.stats||{filledToday:0,cached:0}}}async function Ve(s){const e=(await chrome.storage.local.get(["stats"])).stats||{filledToday:0,cached:0,totalFilled:0};e.filledToday=(e.filledToday||0)+s,e.totalFilled=(e.totalFilled||0)+s,await chrome.storage.local.set({stats:e})}async function He(s){try{const{profile:t}=s||{};t&&(await chrome.storage.local.set({profile:t}),console.log("[Sync] Profile stored from dashboard")),window.postMessage({type:"JOBFILLER_PROFILE_SUCCESS"},"*")}catch(t){console.error("[Sync] Profile error:",t),window.postMessage({type:"JOBFILLER_PROFILE_ERROR",error:String(t)},"*")}}async function We(s){var t,e,o;try{const{uid:n,projectId:a,session:r,resume:i,resumePdf:c,resumeDocx:l}=s||{};console.log("[Sync] Session sync received:",{hasSession:!!r,hasResume:!!i,hasResumePdf:!!c,hasResumeDocx:!!l}),r&&(await chrome.storage.local.set({auth:{uid:n||r.uid,email:((t=r.personalInfo)==null?void 0:t.email)||r.email||"",displayName:((e=r.personalInfo)==null?void 0:e.name)||r.displayName||"",syncedAt:Date.now()},session:r,profile:r}),console.log("[Sync] Session stored from flash"));const h=p=>{if(!p)return null;if(p instanceof ArrayBuffer)return p;if(p.buffer instanceof ArrayBuffer)return p.buffer;if(typeof p=="object"&&p!==null){const m=Object.keys(p);if(m.length>0&&m.every(d=>!isNaN(parseInt(d)))){const d=new Uint8Array(m.length);for(let y=0;y<m.length;y++)d[y]=p[y];return d.buffer}}return console.warn("[Sync] Could not convert buffer:",typeof p),null},u=c||i;if(u){console.log("[Sync] PDF data received:",{name:u.name,type:u.type,bufferType:typeof u.buffer,bufferSize:((o=u.buffer)==null?void 0:o.byteLength)||Object.keys(u.buffer||{}).length});const p=h(u.buffer);p?(await Y("resume",p,u.name||"resume.pdf",u.type||"application/pdf"),console.log("[Sync] PDF resume stored:",u.name,p.byteLength,"bytes")):console.error("[Sync] Failed to convert PDF buffer")}if(l){console.log("[Sync] DOCX data received:",{name:l.name,type:l.type,bufferType:typeof l.buffer});const p=h(l.buffer);p?(await Y("resume-docx",p,l.name||"resume.docx",l.type||"application/vnd.openxmlformats-officedocument.wordprocessingml.document"),console.log("[Sync] DOCX resume stored:",l.name,p.byteLength,"bytes")):console.error("[Sync] Failed to convert DOCX buffer")}const f={};if(u!=null&&u.buffer){const p=h(u.buffer);f.pdf={name:u.name,size:(p==null?void 0:p.byteLength)||0,type:u.type}}if(l!=null&&l.buffer){const p=h(l.buffer);f.docx={name:l.name,size:(p==null?void 0:p.byteLength)||0,type:l.type}}Object.keys(f).length>0&&(await chrome.storage.local.set({resumeInfo:f}),console.log("[Sync] Resume info stored:",f)),window.postMessage({type:"JOBFILLER_SESSION_SUCCESS"},"*")}catch(n){console.error("[Sync] Session error:",n),window.postMessage({type:"JOBFILLER_SESSION_ERROR",error:String(n)},"*")}}async function Ke(s){try{const t=s||{};await chrome.storage.local.set({settings:t}),console.log("[Sync] Settings stored from admin"),window.postMessage({type:"JOBFILLER_SETTINGS_SUCCESS"},"*")}catch(t){console.error("[Sync] Settings error:",t),window.postMessage({type:"JOBFILLER_SETTINGS_ERROR",error:String(t)},"*")}}console.log("[JobFiller Pro V2] Content Script Loading... ⚡");window.addEventListener("message",s=>{var t;((t=s.data)==null?void 0:t.type)==="JOBFILLER_PING"&&(console.log("[JobFiller Pro V2] PING received, responding with PONG"),window.postMessage({type:"JOBFILLER_PONG",installed:!0},"*"))});console.log("[JobFiller Pro V2] Content Script Initialized ⚡");
})()
